/**
 * @id5io/id5-api.js
 * @version v1.0.56
 * @link https://id5.io/
 * @license Apache-2.0
 */
!function(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=17)}([function(e,m,_){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(e){m.generateId=function(){if(void 0!==e&&void 0!==e.crypto&&void 0!==e.crypto.randomUUID)return e.crypto.randomUUID();return"".concat(1e6*Math.random()|0)},m.semanticVersionCompare=function(e,t){var r="^\\d+(\\.\\d+(\\.\\d+){0,1}){0,1}$";if(!e.match(r)||!t.match(r))return;var n=e.split("."),i=t.split("."),r=e=>parseInt(e)||0,e=(e,t)=>{t=e-t;return 0==t?0:t<0?-1:1},t=e(r(n[0]),r(i[0]));if(0!==t)return t;{t=e(r(n[1]),r(i[1]));return 0===t?e(r(n[2]),r(i[2])):t}},m.isA=l,m.isFn=h,m.isStr=p,m.isArray=g,m.isNumber=function(e){return l(e,o)},m.isPlainObject=function(e){return l(e,s)},m.isBoolean=function(e){return l(e,a)},m.isDefined=function(e){return void 0!==e},m.isEmpty=f,m._each=v,m.ajax=function(n,i,o){let s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:t.c;try{let r;var c,l=s.method||(o?"POST":"GET");let e=document.createElement("a");e.href=n;let t="object"==typeof i&&null!==i?i:{success:function(){a.info("ajax","xhr success")},error:function(e){a.error("ajax","xhr error",null,e)}};"function"==typeof i&&(t.success=i),r=new window.XMLHttpRequest,r.onreadystatechange=function(){var e;4===r.readyState&&(200<=(e=r.status)&&e<300||304===e?t.success(r.responseText,r):t.error(r.statusText,r))},r.ontimeout=function(){a.error("ajax","xhr timeout after ",r.timeout,"ms")},"GET"===l&&o&&(d((c=function(e,t){let r=document.createElement("a");t&&"noDecodeWholeURL"in t&&t.noDecodeWholeURL?r.href=e:r.href=decodeURIComponent(e);t=t&&"decodeSearchAsString"in t&&t.decodeSearchAsString;return{href:r.href,protocol:(r.protocol||"").replace(/:$/,""),hostname:r.hostname,port:+r.port,pathname:r.pathname.replace(/^(?!\/)/,"/"),search:t?r.search:function(e){return e?e.replace(/^\?/,"").split("&").reduce((e,t)=>{let r=t.split("="),n=(s=2,function(e){if(Array.isArray(e))return e}(t=r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(t,s)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(t,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=n[0],o=n[1];var s;return/\[\]$/.test(i)?(i=i.replace("[]",""),e[i]=e[i]||[],e[i].push(o)):e[i]=o||"",e},{}):{}}(r.search||""),hash:(r.hash||"").replace(/^#/,""),host:r.host||window.location.host}}(n,s)).search,o),n=function(e){return(e.protocol||"http")+"://"+(e.host||e.hostname+(e.port?":".concat(e.port):""))+(e.pathname||"")+(e.search?"?".concat(function(e){return Object.keys(e).map(t=>Array.isArray(e[t])?e[t].map(e=>"".concat(t,"[]=").concat(e)).join("&"):"".concat(t,"=").concat(e[t])).join("&")}(e.search||"")):"")+(e.hash?"#".concat(e.hash):"")}(c)),r.open(l,n,!0),s.withCredentials&&(r.withCredentials=!0),v(s.customHeaders,(e,t)=>{r.setRequestHeader(t,e)}),s.preflight&&r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-Type",s.contentType||"text/plain"),"POST"===l&&o?r.send(o):r.send()}catch(e){a.error("ajax","xhr construction",e)}},m.cyrb53Hash=function(r){let e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=function(e,t){if(h(Math.imul))return Math.imul(e,t);var r=(4194303&e)*(t|=0);return 4290772992&e&&(r+=(4290772992&e)*t|0),0|r},i=3735928559^e,o=1103547991^e;for(let e=0,t;e<r.length;e++)t=r.charCodeAt(e),i=n(i^t,2654435761),o=n(o^t,1597334677);return i=n(i^i>>>16,2246822507)^n(o^o>>>13,3266489909),o=n(o^o>>>16,2246822507)^n(i^i>>>13,3266489909),(4294967296*(2097151&o)+(i>>>0)).toString()},m.objectEntries=function(e){let t=Object.keys(e),r=t.length,n=new Array(r);for(;r--;)n[r]=[t[r],e[t[r]]];return n};var t=_(1);function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const r="Array",n="String",i="Function",o="Number",s="Object",a="Boolean",c=Object.prototype.toString;function l(e,t){return c.call(e)==="[object "+t+"]"}function h(e){return l(e,i)}function p(e){return l(e,n)}function g(e){return l(e,r)}function f(e){if(!e)return!0;if(g(e)||p(e))return!(0<e.length);for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}function v(t,r){if(!f(t)){if(h(t.forEach))return t.forEach(r,this);let e=0;var n=t.length;if(0<n)for(;e<n;e++)r(t[e],e,t);else for(e in t)hasOwnProperty.call(t,e)&&r.call(this,t[e],e)}}}.call(m,_(20))},function(e,t,r){"use strict";class n{debug(){}info(){}warn(){}error(){}}var i=new(t.a=n);t.c=i;t.b=class extends n{constructor(e,t){super(),this._prefix=e,this._delegate=t}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._delegate.debug(this._prefix,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._delegate.info(this._prefix,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._delegate.warn(this._prefix,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._delegate.error(this._prefix,...t)}}},function(e,t,r){"use strict";var i=r(19),n=(r(12),r(16),r(1));r.d(t,"j",function(){return n.a}),r.d(t,"k",function(){return n.c});var o=r(3);r.d(t,"a",function(){return o.a}),r.d(t,"e",function(){return o.b}),r.d(t,"g",function(){return o.e}),r.d(t,"h",function(){return o.f});var s=r(11);r.d(t,"f",function(){return s.a});var a=r(6);r.d(t,"l",function(){return a.a});var c=r(4);r.d(t,"i",function(){return c.a}),r.d(t,"m",function(){return c.e});var l=r(15);r.d(t,"d",function(){return l.a});var d=r(8);r.d(t,"b",function(){return d.a});var u=r(0);r.d(t,"o",function(){return u});var h=r(9);r.d(t,"c",function(){return h.a});r=new class{createInstance(e,t,r,n){return new i.a(e,{},n,r,t)}};t.n=r},function(e,t,r){"use strict";var n=r(0);const i=["localStoragePurposeConsent","ccpaString"];function o(e,t){if(null==e)return{};var r,n=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],0<=t.indexOf(r)||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r]);return n}function c(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.f="131";const l=Object.freeze({NONE:"none",TCF_V1:"TCFv1",TCF_V2:"TCFv2",USP_V1:"USPv1",ID5_ALLOWED_VENDORS:"ID5",PREBID:"PBJS",GPP_V1_0:"GPPv1.0",GPP_V1_1:"GPPv1.1"});t.a=l;class s extends Error{constructor(e,t){super(t),c(this,"consentData",void 0),this.consentData=e}}t.h=s;t.e=class{constructor(e,t,r,n){c(this,"version",void 0),c(this,"localStoragePurposeConsent",void 0),c(this,"applicableSections",void 0),c(this,"gppString",void 0),this.version=e,this.localStoragePurposeConsent=t,this.applicableSections=r,this.gppString=n}isGranted(){return this.applicableSections.includes(2)?this.localStoragePurposeConsent:!!this.applicableSections.includes(6)||!(!this.applicableSections.includes(0)&&!this.applicableSections.includes(-1)&&0!==this.applicableSections.length)&&(void 0===this.localStoragePurposeConsent||this.localStoragePurposeConsent)}};t.b=class{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:l.NONE,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:void 0,s=6<arguments.length&&void 0!==arguments[6]&&arguments[6],a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:void 0;c(this,"api",void 0),c(this,"gdprApplies",void 0),c(this,"consentString",void 0),c(this,"localStoragePurposeConsent",void 0),c(this,"allowedVendors",void 0),c(this,"ccpaString",void 0),c(this,"forcedGrantByConfig",void 0),c(this,"gppData",void 0),this.api=e,this.gdprApplies=t,this.consentString=r,this.localStoragePurposeConsent=n,this.ccpaString=i,this.allowedVendors=o,this.forcedGrantByConfig=s,this.gppData=a}localStorageGrant(){var e=!0===this.forcedGrantByConfig?a.FORCE_ALLOWED_BY_CONFIG:void 0===this.api||this.api===l.NONE?a.PROVISIONAL:a.CONSENT_API;return new d(this.isGranted(),e,this.api)}isGranted(){switch(this.api){case l.NONE:return!0;case l.TCF_V1:return!this.gdprApplies||!0===this.localStoragePurposeConsent;case l.TCF_V2:case l.PREBID:return!1===this.gdprApplies||!0===this.localStoragePurposeConsent;case l.ID5_ALLOWED_VENDORS:return this.allowedVendors.includes("131");case l.USP_V1:return!0;case l.GPP_V1_0:case l.GPP_V1_1:return this.gppData.isGranted()}}hashCode(){this.localStoragePurposeConsent,this.ccpaString;var e=o(this,i);return Object(n.cyrb53Hash)(JSON.stringify(e))}};const a=Object.freeze({FORCE_ALLOWED_BY_CONFIG:"force_allowed_by_config",ID5_CONSENT:"id5_consent",PROVISIONAL:"provisional",JURISDICTION:"jurisdiction",CONSENT_API:"consent_api"});t.d=a;class d{constructor(e,t,r){c(this,"allowed",!1),c(this,"grantType",a.NONE),c(this,"api",l.NONE),this.allowed=e,this.grantType=t,this.api=r}isDefinitivelyAllowed(){return this.allowed&&this.grantType!==a.PROVISIONAL}}t.g=d;t.c=class{getConsentData(){}localStorageGrant(){}setStoredPrivacy(e){}}},function(e,t,r){"use strict";var n=r(1);function i(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o="_exp";t.a=class{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:n.c;i(this,"storage",void 0),i(this,"_log",void 0),this.storage=e,this._log=t}getItem(e){try{return this.storage.getItem(e)}catch(e){}}setItem(e,t){try{this.storage.setItem(e,t)}catch(e){}}removeItem(e){try{this.storage.removeItem(e)}catch(e){}}getItemWithExpiration(e){var t=e.name,e=this.getItem(t+o);return!e||new Date(e).getTime()-Date.now()<=0?(this.removeItemWithExpiration({name:t}),null):this.getItem(t)}setItemWithExpiration(e,t){var r=e.name,e=e.expiresDays,e=Date.now()+864e5*e,e=new Date(e).toUTCString();this.setItem(r+o,e),this.setItem(r,t)}removeItemWithExpiration(e){e=e.name;this.removeItem(e),this.removeItem(e+o)}setObjectWithExpiration(e,t){var r=e.name,e=e.expiresDays,e=Date.now()+864e5*e;this.setItem(r,JSON.stringify({data:t,expireAt:e}))}getObjectWithExpiration(t){t=t.name;try{var e=JSON.parse(this.getItem(t));if(e.expireAt&&0<e.expireAt-Date.now())return e.data;e.expireAt&&this.removeItem(t)}catch(e){this._log.error("Error while getting ",t,"object from storage",e)}}updateObjectWithExpiration(e,t){var r=e.name,e=e.expiresDays;try{var n=this.getObjectWithExpiration({name:r});this.setObjectWithExpiration({name:r,expiresDays:e},t(n))}catch(e){this._log.error("Error while updating object with ",r,e)}}};class s{getItem(e){}removeItem(e){}setItem(e,t){}}r=new(t.d=s);t.b=r;t.e=class extends s{constructor(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];super(),i(this,"_writingEnabled",void 0),i(this,"_underlying",void 0),this._writingEnabled=t;try{this._underlying=e.localStorage}catch(e){}}getItem(e){try{return this._underlying.getItem(e)}catch(e){}}removeItem(e){try{this._underlying.removeItem(e)}catch(e){}}setItem(e,t){try{this._writingEnabled&&this._underlying.setItem(e,t)}catch(e){}}static checkIfAccessible(){var e="__id5test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}}};t.c=class{constructor(e){i(this,"_replicas",[]),i(this,"_lastKeyOperation",{}),i(this,"_primaryStorage",void 0),this._primaryStorage=e}getItem(e){return this._primaryStorage.getItem(e)}removeItem(t){this._primaryStorage.removeItem(t);var e=e=>{e.removeItem(t)};this._replicas.forEach(e),this._lastKeyOperation[t]=e}setItem(t,r){this._primaryStorage.setItem(t,r);var e=e=>{e.setItem(t,r)};this._replicas.forEach(e),this._lastKeyOperation[t]=e}addReplica(t){Object.values(this._lastKeyOperation).forEach(e=>e(t)),this._replicas.push(t)}}},function(e,t,r){"use strict";t.b=function(e,t){let r=!0;return n.o._each(e,e=>r=r&&t(e)),r},t.p=function(e){l=!!e},t.k=u,t.l=function(){return s},t.d=function(e,t,r){"loading"!==document.readyState?_(e,t,r):document.addEventListener("DOMContentLoaded",function(){_(e,t,r)})},t.e=function(e,t,r,n,i){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:i;return e===i?r:e},t.c=function t(r,n){const e=y(r)&&y(n);if(!e)return r===n;const i=Object.keys(r);const o=Object.keys(n);if(i.length!==o.length)return!1;for(var s=0,a=i;s<a.length;s++){let e=a[s];if(!t(r[e],n[e]))return!1}return!0},t.f=function(e,t){return w.apply(this,arguments)};var n=r(2);function c(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function i(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o="TRUE"===p("id5_debug").toUpperCase(),s="TRACE"===p("id5_debug").toUpperCase(),a=Boolean(window.console);let l=!1;function d(e,t,r,n,i){u()&&a&&e&&e.apply(console,["%cID5 - ".concat(t,"#").concat(r),"color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;",n].concat(i))}function u(){return o||s||l}class h extends n.j{constructor(e,t){super(),i(this,"_invocationId",void 0),i(this,"_origin",void 0),this._invocationId=t,this._origin=e}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];!function(e,t){for(var r=arguments.length,n=new Array(2<r?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];d(console.info,e,t,"DEBUG",n)}(this._origin,this._invocationId,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];!function(e,t){for(var r=arguments.length,n=new Array(2<r?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];d(console.info,e,t,"INFO",n)}(this._origin,this._invocationId,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];!function(e,t){for(var r=arguments.length,n=new Array(2<r?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];d(console.warn,e,t,"WARNING",n)}(this._origin,this._invocationId,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];!function(e,t){for(var r=arguments.length,n=new Array(2<r?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];d(console.error,e,t,"ERROR",n)}(this._origin,this._invocationId,...t)}}function p(e){const t=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=t.exec(window.location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}t.a=h;r=n.o.isA;t.g=r;const g=n.o.isFn;t.j=g;const f=n.o.isStr;t.o=f;const v=n.o.isArray;t.h=v;r=n.o.isNumber;t.m=r;r=n.o.isPlainObject;t.n=r;r=n.o.isBoolean;t.i=r;const m=n.o.isDefined;n.o.isEmpty;new h("ajax");function _(e,t,r){let n=new Image;n.src=e,g(t)&&t(),g(r)&&(n.complete?r():n.addEventListener("load",r))}function b(e,t){const r=[];return n.o._each(e,e=>{t(e)&&r.push(e)}),r}const y=e=>null!=e&&"object"==typeof e;function w(){var a;return a=function*(e,t){if(m(window.navigator.userAgentData)&&!e){let e;try{e=yield window.navigator.userAgentData.getHighEntropyValues(["architecture","fullVersionList","model","platformVersion"])}catch(e){return void t.error("Error while calling navigator.userAgentData.getHighEntropyValues()",e)}return function(e){if(!m(e))return;const t=/[()-.:;=?_/]/g;v(e.brands)&&(e.brands=b(e.brands,e=>f(e.brand)&&e.brand.search(t)<0));v(e.fullVersionList)&&(e.fullVersionList=b(e.fullVersionList,e=>f(e.brand)&&e.brand.search(t)<0));return e}(e)}},(w=function(){var e=this,s=arguments;return new Promise(function(t,r){var n=a.apply(e,s);function i(e){c(n,t,r,i,o,"next",e)}function o(e){c(n,t,r,i,o,"throw",e)}i(void 0)})}).apply(this,arguments)}},function(e,t,r){"use strict";var l=r(0),n=r(9);function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a{constructor(e,t){this.name=e,this.expiresDays=t}withNameSuffixed(){let e=this.name;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=0,o=r;i<o.length;i++){var s=o[i];e+="_".concat(s)}return new a(e,this.expiresDays)}}t.a=class{constructor(){let r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;function e(e){var t=void 0!==r?Math.max(1,r):e.expiresDays;return new a(e.name,t)}var t=n.a.STORAGE_CONFIG;this.ID5=e(t.ID5),this.LAST=e(t.LAST),this.CONSENT_DATA=e(t.CONSENT_DATA),this.PD=e(t.PD),this.PRIVACY=e(t.PRIVACY),this.SEGMENTS=e(t.SEGMENTS)}};class u{constructor(){i(this,"storedResponse",void 0),i(this,"storedDateTime",void 0),i(this,"pdHasChanged",void 0),i(this,"segmentsHaveChanged",void 0),i(this,"refreshInSeconds",void 0),i(this,"nb",void 0),i(this,"consentHasChanged",void 0)}isResponsePresent(){return void 0!==this.storedResponse}hasValidUid(){return this.storedResponse&&this.storedResponse.universal_uid}isResponseComplete(){return this.storedResponse&&this.storedResponse.universal_uid&&this.storedResponse.signature}refreshInSecondsHasElapsed(){return this.storedDateTime<=0||Date.now()-this.storedDateTime>1e3*this.refreshInSeconds}isStoredIdStale(){return this.storedDateTime<=0||12096e5<Date.now()-this.storedDateTime}}t.b=class{constructor(e){i(this,"_clientStore",void 0),this._clientStore=e}getStoredDataState(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=this._clientStore.getResponse(),i=this._clientStore.getDateTime();let o={},s=!1,a=!1,c=e[0].refreshInSeconds||7200;e.forEach(e=>{var t=e.partnerId,r=this._clientStore.getNb(t);o[t]=void 0!==r?r:0;r=!this._clientStore.isStoredPdUpToDate(t,e.pd),t=!this._clientStore.storedSegmentsMatchesSegments(t,e.segments);a=a||t,s=s||r,c>e.refreshInSeconds&&(c=e.refreshInSeconds)}),Object(l.isNumber)(null==n||null===(t=n.cache_control)||void 0===t?void 0:t.max_age_sec)&&(c=n.cache_control.max_age_sec);r=r&&!this._clientStore.storedConsentDataMatchesConsentData(r);return d(new u,{storedResponse:n,storedDateTime:i,pdHasChanged:s,segmentsHaveChanged:a,refreshInSeconds:c,nb:o,consentHasChanged:r})}storeRequestData(e,t){this._clientStore.putHashedConsentData(e),t.forEach(e=>{var t=e.partnerId,r=e.pd,e=e.segments;this._clientStore.isStoredPdUpToDate(t,r)||this._clientStore.putHashedPd(t,r),this._clientStore.putHashedSegments(t,e)})}incNbs(e,r){e.forEach(e=>{var t=e.partnerId;r.nb[t]=this._clientStore.incNbV1(t,r.nb[t]),this._clientStore.incNbV2(e.cacheId)})}storeResponse(e,r,t){this._clientStore.putResponseV1(r.getGenericResponse()),this._clientStore.setResponseDateTimeV1(new Date(r.timestamp).toUTCString());const n=t?0:1;e.forEach(e=>{var t=e.partnerId;this._clientStore.setNbV1(t,n);t=e.cacheId;this._clientStore.setNbV2(t,n),this._clientStore.storeResponseV2(t,r.getResponseFor(e.integrationId),r.timestamp)})}clearAll(e){this._clientStore.clearResponse(),this._clientStore.clearDateTime(),e.forEach(e=>{e=e.partnerId;this._clientStore.clearNb(e),this._clientStore.clearHashedPd(e),this._clientStore.clearHashedSegments(e)}),this._clientStore.clearHashedConsentData()}}},function(e,t,r){"use strict";var n=r(1);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function a(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o="*";t.b=void 0;class s{constructor(e,t,r,n,i,o){var s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;a(this,"_isId5Message",!0),a(this,"id",void 0),a(this,"timestamp",void 0),a(this,"type",void 0),a(this,"src",void 0),a(this,"dst",void 0),a(this,"request",void 0),a(this,"payload",void 0),this.id=n,this.timestamp=e,this.src=t,this.dst=r,this.type=o,this.request=s,this.payload=i}}class c{constructor(e){a(this,"_senderId",void 0),a(this,"_messageSeqNb",0),this._senderId=e,this._messageSeqNb=0}createBroadcastMessage(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.constructor.name;return new s(Date.now(),this._senderId,void 0,++this._messageSeqNb,e,t||e.constructor.name)}createResponse(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;return new s(Date.now(),this._senderId,e.src,++this._messageSeqNb,t,r||t.constructor.name,e)}createUnicastMessage(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;return new s(Date.now(),this._senderId,e,++this._messageSeqNb,t,r||t.constructor.name)}}class l{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;a(this,"instance",void 0),a(this,"instanceState",void 0),a(this,"isResponse",void 0),this.instance=e,this.instanceState=r,this.isResponse=t}}a(t.c=l,"TYPE","HelloMessage");r=Object.freeze({LEADER:"leader",FOLLOWER:"follower",STORAGE:"storage"});t.e=r;class d{constructor(e,t,r){a(this,"target",void 0),a(this,"methodName",void 0),a(this,"methodArguments",void 0),this.target=e,this.methodName=t,this.methodArguments=r}}a(d,"TYPE","RemoteMethodCallMessage");t.d=class{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.c;a(this,"_targets",{}),a(this,"_log",void 0),this._log=e}registerTarget(e,t){return this._targets[e]=t,this}_handle(t){const e=this._targets[t.target];if(e)try{e[t.methodName](...t.methodArguments)}catch(e){this._log.error("Error while handling method call ",t,e)}}};t.a=class{constructor(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n.c;a(this,"_id",void 0),a(this,"_messageFactory",void 0),a(this,"_log",void 0),a(this,"_onMessageCallBackFunction",void 0),this._id=e,this._messageFactory=new c(this._id),this._log=r,this._window=t,this._handlers={},this._register()}_register(){const i=this;i._abortController="undefined"!=typeof AbortController?new AbortController:void 0;var e=null===(e=i._abortController)||void 0===e?void 0:e.signal;i._window.addEventListener("message",r=>{let n=r.data;if(void 0!==r.data&&r.data._isId5Message)if(r.data.src!==i._id)if(void 0===r.data.dst||r.data.dst===i._id)try{[o,n.type].forEach(e=>{let t=i._handlers[e];t&&t.forEach(e=>e(n,r.source))})}catch(e){i._log.error("Error while handling message",n,e)}else i._log.debug("Ignore msg not to me");else i._log.debug("Ignore loopback msg")},{capture:!1,signal:e})}deregister(){this._abortController&&this._abortController.abort()}onAnyMessage(e){return this.onMessage(o,e)}onMessage(e,t){const r=this._handlers[e];return r?r.push(t):this._handlers[e]=[t],this}broadcastMessage(e,t){this._log.debug("Broadcasting message",t,e),this._postMessage(this._messageFactory.createBroadcastMessage(e,t))}sendResponseMessage(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;this._log.debug("Sending response message",e,r,t),this._postMessage(this._messageFactory.createResponse(e,t,r))}unicastMessage(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.constructor.name;this._log.debug("Sending message to",e,r,t),this._postMessage(this._messageFactory.createUnicastMessage(e,t,r))}_postToWindow(e,t){try{e.postMessage(t,"*")}catch(e){this._log.error("Could not post message to window",e)}}_postMessage(n){let i=this;(function t(e){try{i._postToWindow(e,n);var r=e.frames;if(r)for(let e=0;e<r.length;e++)t(r[e])}catch(e){i._log.error("Could not broadcast message",e)}})(i._window.top)}callProxyMethod(e,t,r,n){this._log.info("Calling ProxyMethodCall",{target:t,name:r,args:n}),this.unicastMessage(e,new d(t,r,n),d.TYPE)}onProxyMethodCall(t){return this.onMessage(d.TYPE,e=>{t._handle(i(new d,e.payload))})}}},function(e,t,r){"use strict";var n=r(1);function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=Object.freeze({CONSENT_UPDATED:"consent_updated",USER_ID_READY:"user_id_ready",CASCADE_NEEDED:"fire_sync_pixel",USER_ID_FETCH_CANCELED:"user_id_fetch_canceled",USER_ID_FETCH_FAILED:"user_id_fetch_failed"});t.a=o;r=Object.freeze({ID5_MESSAGE_RECEIVED:"message",ID5_INSTANCE_JOINED:"instance-joined",ID5_LEADER_ELECTED:"leader-elected"});t.c=r;const s=Object.freeze([...Object.values(r),...Object.values(o)]);t.b=class{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.c;i(this,"_handlers",void 0),i(this,"_log",void 0),this._log=e,this._handlers={}}_dispatch(t){var e=this._handlers[t];if(e){for(var r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o,s=c(e);try{for(s.s();!(o=s.n()).done;){const a=o.value;try{a(...n)}catch(e){this._log.error("Event ".concat(t," handler execution failed."),e)}}}catch(e){s.e(e)}finally{s.f()}}}emit(e){if(void 0!==e&&s.includes(e)){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._dispatch(e,...r)}else this._log.warn("Unsupported event",e)}on(e,t){void 0!==e&&s.includes(e)?(this._handlers[e]||(this._handlers[e]=[]),this._handlers[e].push(t)):this._log.warn("Unsupported event",e)}}},function(e,t,r){"use strict";t.a=Object.freeze({STORAGE_CONFIG:{ID5:{name:"id5id",expiresDays:90},LAST:{name:"id5id_last",expiresDays:90},CONSENT_DATA:{name:"id5id_cached_consent_data",expiresDays:30},PD:{name:"id5id_cached_pd",expiresDays:30},SEGMENTS:{name:"id5id_cached_segments",expiresDays:30},PRIVACY:{name:"id5id_privacy",expiresDays:30}},LEGACY_COOKIE_NAMES:["id5.1st","id5id.1st"],PRIVACY:{JURISDICTIONS:{gdpr:!0,ccpa:!1,lgpd:!0,other:!1}},ID5_EIDS_SOURCE:"id5-sync.com"})},function(e,t,r){"use strict";t.b=function(r,n){if(Math.random()<r&&i.a)return(e,t)=>new i.b(n,{sampling:r}).publish(e,t);return e=>e},t.d=function(){return new o.c},t.c=c;var i=r(25),n=r(26),o=r(13);function s(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function a(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach(function(e){var t,r;t=n,e=i[r=e],(r=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}function c(e){return{partner:e}}class l extends n.a{constructor(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;super(a(a({source:e,version:t},c(r)),n),"id5.api")}loadDelayTimer(){return this.timer("instance.load.delay",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}fetchCallTimer(e){return this.timer("fetch.call.time",a({status:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}fetchFailureCallTimer(){return this.fetchCallTimer("fail",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}fetchSuccessfulCallTimer(){return this.fetchCallTimer("success",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}extensionsCallTimer(e,t){return this.timer("extensions.call.time",a({extensionType:e,status:t?"success":"fail"},2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}))}consentRequestTimer(e){return this.timer("consent.request.time",a({requestType:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}invocationCountSummary(){return this.summary("invocation.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}instanceCounter(e){return this.counter("instance.count",a({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceUniqueDomainsCounter(e){return this.counter("instance.domains.count",a({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceUniqWindowsCounter(e){return this.counter("instance.windows.count",a({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceUniqPartnersCounter(e){return this.counter("instance.partners.count",a({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceJoinDelayTimer(){return this.timer("instance.join.delay.time",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}instanceLateJoinCounter(e){return this.counter("instance.lateJoin.count",a({instanceId:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}instanceLateJoinDelayTimer(){return this.timer("instance.lateJoin.delay",a({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))}instanceLastJoinDelayTimer(){return this.timer("instance.lastJoin.delay",a({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))}instanceMsgDeliveryTimer(){return this.timer("instance.message.delivery.time",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}userIdProvisioningDelayTimer(e){return this.timer("userid.provisioning.delay",a({cachedResponseUsed:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}userIdNotificationDeliveryDelayTimer(){return this.timer("userid.provisioning.delivery.delay",a({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))}consentChangeCounter(){return this.counter("leader.consent.change.count",0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}}t.a=l},function(e,t,r){"use strict";var n=r(0),i=r(9),o=r(12),s=r(3);function a(){return(a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class l extends s.c{constructor(e,t,r,n){super(),c(this,"_consentDataHolder",void 0),c(this,"storedPrivacyData",void 0),c(this,"localStorage",void 0),c(this,"_forceAllowLocalStorageGrant",void 0),this._log=n,this.localStorage=e,this.storageConfig=t,this._consentDataHolder=new o.a,this._forceAllowLocalStorageGrant=r}resetConsentData(e){this._consentDataHolder.reset(),this.storedPrivacyData=void 0,this._forceAllowLocalStorageGrant=e}localStorageGrant(){const e=this._log;if(!0===this._forceAllowLocalStorageGrant)return e.warn("cmpApi: Local storage access granted by configuration override, consent will not be checked"),new s.g(!0,s.d.FORCE_ALLOWED_BY_CONFIG,s.a.NONE);if(this._consentDataHolder.hasValue()&&this._consentDataHolder.getValue().api!==s.a.NONE)return this._consentDataHolder.getValue().localStorageGrant();if(Object(n.isPlainObject)(this.storedPrivacyData)||(t=this.localStorage.getItemWithExpiration(this.storageConfig.PRIVACY),this.storedPrivacyData=t&&JSON.parse(t),e.info("cmpApi: Loaded stored privacy data from local storage",this.storedPrivacyData)),this.storedPrivacyData&&!0===this.storedPrivacyData.id5_consent)return new s.g(!0,s.d.ID5_CONSENT,s.a.NONE);if(!this.storedPrivacyData||!Object(n.isDefined)(this.storedPrivacyData.jurisdiction))return new s.g(!0,s.d.PROVISIONAL,s.a.NONE);var t=this.storedPrivacyData.jurisdiction,t=t in i.a.PRIVACY.JURISDICTIONS&&i.a.PRIVACY.JURISDICTIONS[t];return new s.g(!1===t,s.d.JURISDICTION,s.a.NONE)}setStoredPrivacy(e){const t=this._log;try{Object(n.isPlainObject)(e)?(this.storedPrivacyData=e,this.localStorage.setItemWithExpiration(this.storageConfig.PRIVACY,JSON.stringify(e))):t.error("cmpApi: Cannot store privacy data if it is not an object",e)}catch(e){t.error("cmpApi: Error while storing privacy data",e)}}setConsentData(e){this._log.debug("Set consent data",e);e=a(new s.b,e);this._consentDataHolder.set(e)}getConsentData(){return this._consentDataHolder.getValuePromise()}}t.a=l},function(e,t,r){"use strict";var n=r(0);function i(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.a=class{constructor(){i(this,"_valuePromise",void 0),i(this,"_value",void 0),i(this,"_resolve",void 0),this.reset()}reset(){const r=this;r._value=void 0,r._valuePromise=new Promise((e,t)=>{r._resolve=e})}set(e){this._value=e,this._resolve(this._value)}getValuePromise(){return this._valuePromise}hasValue(){return Object(n.isDefined)(this._value)}getValue(){return this._value}}},function(e,t,r){"use strict";var n=r(14);function i(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o=Object.freeze({TIMER:"TIMER",SUMMARY:"SUMMARY",COUNTER:"COUNTER"});class s{constructor(e,t,r){i(this,"name",void 0),i(this,"tags",void 0),i(this,"values",void 0),this.name=e,this.tags=n.a.from(t),this.type=r,this.values=[]}reset(){this.values=[]}}t.d=class extends s{constructor(e){super(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,o.TIMER)}startMeasurement(){try{return new a(this)}catch(e){return}}record(e){try{isNaN(e)||this.values.push({value:e,timestamp:Date.now()})}catch(e){}}recordNow(){try{var e;this.record(0|(null===(e=performance)||void 0===e?void 0:e.now()))}catch(e){}}};class a{constructor(){this.timer=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,this.startTime=performance.now()}record(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;try{var r=performance.now()-this.startTime|0;let e=t||this.timer;return e&&e.record(r),r}catch(e){return}}}t.c=a;t.a=class extends s{constructor(e){super(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,o.COUNTER)}inc(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;try{return 0===this.values.length?this.values.push({value:e,timestamp:Date.now()}):(this.values[0].value+=e,this.values[0].timestamp=Date.now()),this.values[0].value}catch(e){}}};t.b=class extends s{constructor(e){super(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,o.SUMMARY)}record(e){try{this.values.push({value:e,timestamp:Date.now()})}catch(e){}}}},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const o=Object.freeze({});t.a={EMPTY:o,from:function(e){return e?e instanceof Map?Object.fromEntries(e):e:o},toString:function(e){return Array.from(Object.entries(e),e=>{var t=n(e,2),e=t[0],t=t[1];return"".concat(e,"=").concat(t)}).sort().toString()}}},function(e,t,r){"use strict";var i=r(0),n=r(3);r(6),r(4);function o(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){a(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function a(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class c{constructor(e,t,r,n){a(this,"localStorageGrantChecker",void 0),a(this,"localStorage",void 0),a(this,"_log",void 0),this.localStorageGrantChecker=e,this.localStorage=t,this.storageConfig=r,this._log=n}get(e){const t=this._log;try{const n=this.localStorageGrant();if(n.isDefinitivelyAllowed()){var r=this.localStorage.getItemWithExpiration(e);return t.info("Local storage get key=".concat(e.name," value=").concat(r)),r}t.warn("clientStore.get() has been called without definitive grant",n)}catch(e){t.error(e)}}clear(e){const t=this._log;try{this.localStorage.removeItemWithExpiration(e)}catch(e){t.error(e)}}_put(e,t){const r=this._log;try{const n=this.localStorageGrant();n.isDefinitivelyAllowed()?(r.info("Local storage put key=".concat(e.name," value=").concat(t)),this.localStorage.setItemWithExpiration(e,t)):r.warn("clientStore._put() has been called without definitive grant",n)}catch(e){r.error(e)}}_updateObject(e,t){const r=this._log;try{const n=this.localStorageGrant();n.isDefinitivelyAllowed()?this.localStorage.updateObjectWithExpiration(e,t):r.warn("clientStore._updateObject() has been called without definitive grant",n)}catch(e){r.error(e)}}localStorageGrant(){return this.localStorageGrantChecker()}getResponse(){var e=this.get(this.storageConfig.ID5);return e&&JSON.parse(decodeURIComponent(e))}clearResponse(){this.clear(this.storageConfig.ID5)}putResponseV1(e){this._put(this.storageConfig.ID5,encodeURIComponent(Object(i.isStr)(e)?e:JSON.stringify(e)))}getHashedConsentData(){return this.get(this.storageConfig.CONSENT_DATA)}clearHashedConsentData(){this.clear(this.storageConfig.CONSENT_DATA)}putHashedConsentData(e){e!==new n.b&&this._put(this.storageConfig.CONSENT_DATA,e.hashCode())}getHashedPd(e){return this.get(this.pdCacheConfig(e))}isStoredPdUpToDate(e,t){var r=this.getHashedPd(e),n=Object(i.isEmpty)(t)&&!Object(i.isEmpty)(r),e=Object(i.isEmpty)(r)&&Object(i.isEmpty)(t);return n||e||r===c.makeStoredHash(t)}clearHashedPd(e){this.clear(this.pdCacheConfig(e))}putHashedPd(e,t){this._put(this.pdCacheConfig(e),c.makeStoredHash(t))}getHashedSegments(e){return this.get(this.segmentsCacheConfig(e))}putHashedSegments(e,t){this._put(this.segmentsCacheConfig(e),c.makeStoredHash(JSON.stringify(t)))}storedSegmentsMatchesSegments(e,t){return c.storedDataMatchesCurrentData(this.getHashedSegments(e),c.makeStoredHash(JSON.stringify(t)))}clearHashedSegments(e){this.clear(this.segmentsCacheConfig(e))}static makeStoredHash(e){return Object(i.cyrb53Hash)("string"==typeof e?e:"")}getDateTime(){return new Date(this.get(this.storageConfig.LAST)).getTime()}clearDateTime(){this.clear(this.storageConfig.LAST)}setResponseDateTimeV1(e){this._put(this.storageConfig.LAST,e)}getNb(e){e=this.get(this.nbCacheConfig(e));return e?parseInt(e):0}clearNb(e){this.clear(this.nbCacheConfig(e))}setNbV1(e,t){this._put(this.nbCacheConfig(e),t)}incNbV1(e,t){return t=Math.round(t+1),this.setNbV1(e,t),t}pdCacheConfig(e){return this.storageConfig.PD.withNameSuffixed(e)}nbCacheConfig(e){return this.storageConfig.ID5.withNameSuffixed(e,"nb")}segmentsCacheConfig(e){return this.storageConfig.SEGMENTS.withNameSuffixed(e)}storeResponseV2(e,t){let r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Date.now();this._updateObject(this.storageConfig.ID5.withNameSuffixed("v2",e),e=>s(s({},e),{},{response:t,responseTimestamp:r}))}incNbV2(e){this._updateObject(this.storageConfig.ID5.withNameSuffixed("v2",e),e=>{var t=Object(i.isNumber)(null==e?void 0:e.nb)?Math.round(e.nb)+1:1;return s(s({},e),{},{nb:t})})}setNbV2(e,t){Object(i.isNumber)(t)&&this._updateObject(this.storageConfig.ID5.withNameSuffixed("v2",e),e=>s(s({},e),{},{nb:t}))}static storedDataMatchesCurrentData(e,t){return null==e||e===t}storedConsentDataMatchesConsentData(e){return c.storedDataMatchesCurrentData(this.getHashedConsentData(),e.hashCode())}}t.a=c},function(e,t,r){"use strict";var i=r(10);function n(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach(function(e){s(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function s(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a{constructor(e,t){s(this,"_metrics",void 0),s(this,"_log",void 0),this._metrics=e,this._log=t}static getChunkUrl(e,t){return"https://c".concat(e,".eu-").concat(t,"-id5-sync.com")}submitExtensionCall(t,r){let n=Object(i.d)();return fetch(t).then(e=>{if(e.ok)return n.record(this._metrics.extensionsCallTimer(r,!0)),e.json();n.record(this._metrics.extensionsCallTimer(r,!1));e="The call to get extensions at ".concat(t," was not ok, status: ").concat(e.status,", statusText: ").concat(e.statusText);return this._log.warn(e),Promise.reject(new Error(e))}).catch(e=>(n.record(this._metrics.extensionsCallTimer(r,!1)),this._log.warn("Got error from ".concat(t," endpoint"),e),{}))}gatherChunks(e,r){if(e){let t=Object(i.d)();return Promise.all(Array.from({length:r.length},(e,t)=>{t=a.getChunkUrl(t,r.urlVersion);return fetch(t).then(e=>{if(e.ok)return e.text();throw new Error("The call to get ".concat(r.name," was not ok, status: ").concat(e.status,", statusText: ").concat(e.statusText))})})).then(e=>(t.record(this._metrics.extensionsCallTimer(r.name,!0)),{[r.name]:e,[r.name+"Version"]:"".concat(r.version)})).catch(e=>(t.record(this._metrics.extensionsCallTimer(r.name,!1)),this._log.warn("Got error when getting ".concat(r.name),e),{}))}return Promise.resolve({})}gather(r){let n=Object(i.d)();return this.submitExtensionCall("https://lb.eu-1-id5-sync.com/lb/v1","lb").then(e=>{var t=this.getChunksEnabled(r,e);return Promise.allSettled([Promise.resolve(e),this.gatherChunks(t,a.CHUNKS_CONFIGS.devChunks),this.gatherChunks(t,a.CHUNKS_CONFIGS.groupChunks)])}).then(e=>{n.record(this._metrics.extensionsCallTimer("all",!0));let t=a.DEFAULT_RESPONSE;return e.forEach(e=>{e.value&&(t=o(o({},t),e.value))}),t}).catch(e=>(n.record(this._metrics.extensionsCallTimer("all",!1)),this._log.error("Got error ".concat(e," when gathering extensions data")),a.DEFAULT_RESPONSE))}getChunksEnabled(e,t){e=e.some(e=>e.pd&&""!==e.pd.trim()),t=null==t?void 0:t.chunks;return 0!==t&&(e||t)}}s(a,"CHUNKS_CONFIGS",Object.freeze({devChunks:{name:"devChunks",urlVersion:3,length:8,version:4},groupChunks:{name:"groupChunks",urlVersion:4,length:8,version:4}})),s(a,"DEFAULT_RESPONSE",{lbCDN:"%%LB_CDN%%"}),t.a={createExtensions:function(e,t){return new a(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r=r(18);window.ID5||(window.ID5=r.a)},function(e,t,r){"use strict";var g=r(5),n=r(27),f=r(28),v=r(30),m=r(31),_=r(32),b=r(10),y=r(2);function i(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function w(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){o(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function o(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const O="api";r=new class{set debug(e){Object(g.p)(e)}get debug(){return Object(g.k)()}constructor(){o(this,"loaded",!1),o(this,"_isUsingCdn",!1),o(this,"_referer",!1),o(this,"_version",m.a),o(this,"versions",{}),o(this,"invocationId",0),this.loaded=!0,this._isUsingCdn=!!(document&&document.currentScript&&document.currentScript.src&&0===document.currentScript.src.indexOf("https://cdn.id5-sync.com")),this._referer=Object(n.a)(),this.versions[m.a]=!0}init(e){this.invocationId+=1;const n=new g.a(O,this.invocationId);try{n.info("ID5 API version ".concat(this._version,". Invoking init()"),e);const s=new _.a(e,n),a=s.getOptions(),c=this._configureDiagnostics(a.partnerId,a.diagnostics,n);c&&(c.loadDelayTimer().recordNow(),c.invocationCountSummary().record(this.invocationId));var t=new y.m(window,!s.hasCreativeRestrictions()),r=new y.i(t);const l=a.allowLocalStorageWithoutConsentApi||a.debugBypassConsent,d=new y.f(r,s.storageConfig,l,n);var i=new y.d(()=>d.localStorageGrant(),r,s.storageConfig,n);const u=y.n.createInstance(window,n,c,t);var o=new f.a(c,n);const h=new v.a(s,i,d,c,o,n,u),p=Object(b.d)();return u.on(y.b.CASCADE_NEEDED,this._doCascade(h)).on(y.b.USER_ID_READY,(e,t)=>{try{var r=null!=t&&t.tags?w({},t.tags):{};null!=t&&t.timestamp&&c.userIdNotificationDeliveryDelayTimer(r).record(Date.now()-t.timestamp),p.record(c.userIdProvisioningDelayTimer(e.isFromCache,w(w({},r),{},{isUpdate:h._userIdAvailable})))}catch(e){n.error("Failed to measure provisioning metrics",e)}h.setUserId(e.responseObj,e.isFromCache)}).on(y.b.USER_ID_FETCH_CANCELED,e=>n.info("ID5 User ID fetch canceled:",e.reason)),this._gatherFetchIdData(h).then(e=>{var t;return u.register({source:O,sourceVersion:m.a,sourceConfiguration:{options:h.getOptions()},fetchIdData:e,singletonMode:!0===(null===a||void 0===a||null===(t=a.multiplexing)||void 0===t?void 0:t._disabled),canDoCascade:!a.applyCreativeRestrictions,forceAllowLocalStorageGrant:l,storageExpirationDays:a.storageExpirationDays})}),this._submitRefreshConsent(a,o,u,c,n).then(e=>{e&&d.setConsentData(e)}),n.info("ID5 initialized for partner ".concat(a.partnerId," with referer ").concat(this._referer.referer," and options"),e),h}catch(e){n.error("Exception caught during init()",e)}}_doCascade(s){return e=>{const t=s._logger,r=s.config;var n,i,o=r.getOptions();e.partnerId===o.partnerId&&0<=o.maxCascades&&!r.hasCreativeRestrictions()&&(n=o.partnerUserId&&0<o.partnerUserId.length,i=e.gppString?"&gpp=".concat(e.gppString,":&gpp_sid=").concat(e.gppSid):"",i="".concat("https://id5-sync.com","/").concat(n?"s":"i","/").concat(o.partnerId,"/").concat(o.maxCascades,".gif?")+"id5id=".concat(e.userId,"&o=api").concat(n?"&puid="+o.partnerUserId:"","&gdpr_consent=").concat(e.consentString,"&gdpr=").concat(e.gdprApplies).concat(i),t.info("Opportunities to cascade available",i),Object(g.d)(i))}}_submitRefreshConsent(e,t,r,n,i){let o=Object(b.d)(),s=e.debugBypassConsent?"bypass":e.cmpApi;return t.refreshConsentData(e.debugBypassConsent,e.cmpApi,e.consentData).then(e=>(o.record(n.consentRequestTimer(s,{success:!0,apiType:e.api})),r.updateConsent(e),e)).catch(e=>{i.error("Couldn't get consent data",e),o.record(n.consentRequestTimer(s,{success:!1,error:e.message}))})}refreshId(e){let t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!Object(g.i)(t))throw new Error("Invalid signature for refreshId(): second parameter must be a boolean");const n=e._logger;try{n.info("Invoking refreshId()",arguments),e.startRefresh(t),e.updateOptions(r);var i=e.getOptions();const o=e.instance,s=i.allowLocalStorageWithoutConsentApi||i.debugBypassConsent;this._gatherFetchIdData(e).then(e=>{o.updateFetchIdData(e),o.refreshUid({resetConsent:!0,forceAllowLocalStorageGrant:s,forceFetch:t})}),this._submitRefreshConsent(i,e._consentDataProvider,o,e._metrics,e._logger)}catch(e){n.error("Exception caught from refreshId()",e)}return e}_gatherFetchIdData(t){const r=t.getOptions();var e=t._logger;return Object(g.f)(r.disableUaHints,e).then(e=>({partnerId:r.partnerId,refererInfo:this._referer,origin:O,originVersion:this._version,isUsingCdn:this._isUsingCdn,att:r.att,uaHints:e,abTesting:r.abTesting,segments:r.segments,invalidSegmentsCount:t.getInvalidSegments(),provider:r.provider,pd:r.pd,partnerUserId:r.partnerUserId,refreshInSeconds:r.refreshInSeconds,providedRefreshInSeconds:t.getProvidedOptions().refreshInSeconds,trace:Object(g.l)()}))}_configureDiagnostics(t,r,n){try{let e=new b.a(O,m.a);var i;return e.addCommonTags(w(w({},Object(b.c)(t)),{},{tml:this._referer.topmostLocation})),null!=r&&r.publishingDisabled||(i=Object(b.b)(r.publishingSampleRatio),null!=r&&r.publishAfterLoadInMsec&&0<r.publishAfterLoadInMsec&&e.schedulePublishAfterMsec(r.publishAfterLoadInMsec,i),null!=r&&r.publishBeforeWindowUnload&&e.schedulePublishBeforeUnload(i)),e}catch(e){return void n.error("Failed to configure diagnostics",e)}}};t.a=r},function(e,t,r){"use strict";var o=r(7),a=r(0),c=r(21),l=r(1),d=r(22),u=r(8),h=r(23),p=r(4),g=r(6),f=r(11),v=r(24),m=r(15),_=r(16);function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function y(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const w=Object.freeze({UNKNOWN:"unknown",LEADER:"leader",FOLLOWER:"follower"}),O=Object.freeze({MULTIPLEXING:"multiplexing",SINGLETON:"singleton"}),n=Object.freeze({AWAITING_SCHEDULE:"awaiting_schedule",SKIPPED:"skipped",SCHEDULED:"scheduled",COMPLETED:"completed",CANCELED:"canceled"});class s{constructor(e,t,r){y(this,"properties",void 0),y(this,"knownState",void 0),y(this,"_joinTime",void 0),y(this,"_window",void 0),this.properties=e,this.knownState=t,this._window=r,this._joinTime=performance.now()}getId(){return this.properties.id}isMultiplexingPartyAllowed(){var e;return(null===(e=this.knownState)||void 0===e?void 0:e.operatingMode)===O.MULTIPLEXING}getInstanceMultiplexingLeader(){var e,t;if((null===(e=this.knownState)||void 0===e?void 0:e.operatingMode)===O.MULTIPLEXING)return null===(e=this.knownState)||void 0===e||null===(t=e.multiplexing)||void 0===t?void 0:t.leader}getWindow(){return this._window}}class i{constructor(e){y(this,"_knownValues",[]),y(this,"_counter",void 0),this._counter=e}add(e){e&&-1===this._knownValues.indexOf(e)&&(this._counter.inc(),this._knownValues.push(e))}}class S{constructor(e,t){y(this,"_instancesCounter",void 0),y(this,"_domainsCounter",void 0),y(this,"_windowsCounter",void 0),y(this,"_partnersCounter",void 0);var r=t.id;this._instancesCounter=e.instanceCounter(t.id),this._windowsCounter=new i(e.instanceUniqWindowsCounter(r)),this._partnersCounter=new i(e.instanceUniqPartnersCounter(r)),this._domainsCounter=new i(e.instanceUniqueDomainsCounter(r))}addInstance(e){var t,r,n;this._instancesCounter.inc(),this._partnersCounter.add((null==e||null===(t=e.fetchIdData)||void 0===t?void 0:t.partnerId)|(null==e||null===(r=e.sourceConfiguration)||void 0===r||null===(n=r.options)||void 0===n?void 0:n.partnerId)),this._domainsCounter.add(null==e?void 0:e.domain),this._windowsCounter.add(null==e?void 0:e.href)}}class C{constructor(e){y(this,"_scheduleTime",void 0),y(this,"_closeTime",void 0),y(this,"_timeoutId",void 0),y(this,"_state",n.AWAITING_SCHEDULE),y(this,"_delayMs",void 0),y(this,"_instance",void 0),this._instance=e}schedule(e){const t=this;t._delayMs=e,this._timeoutId=setTimeout(()=>{t._timeoutId&&(t._timeoutId=void 0,t._instance._doElection(),t._closeWithState(n.COMPLETED))},t._delayMs),t._state=n.SCHEDULED,t._scheduleTime=performance.now()}skip(){this._closeWithState(n.SKIPPED)}cancel(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0),this._closeWithState(n.CANCELED)}_closeWithState(e){this._state=e,this._closeTime=performance.now()}}t.a=class{constructor(e,t,r,n){var i,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:l.c;y(this,"properties",void 0),y(this,"_messenger",void 0),y(this,"_knownInstances",new Map),y(this,"_lastJoinedInstance",void 0),y(this,"role",void 0),y(this,"_leader",void 0),y(this,"_mode",void 0),y(this,"_metrics",void 0),y(this,"_logger",void 0),y(this,"_instanceCounters",void 0),y(this,"_election",void 0),y(this,"_window",void 0),y(this,"_storage",void 0);var s=a.generateId();this.properties=b({id:s,version:c.a,href:null===(i=e.location)||void 0===i?void 0:i.href,domain:null===(i=e.location)||void 0===i?void 0:i.hostname},t),this.role=w.UNKNOWN,this._metrics=n,this._instanceCounters=new S(n,this.properties),this._loadTime=performance.now(),this._logger=void 0!==o?new l.b("Instance(id=".concat(s,")"),o):l.c,this._window=e,this._dispatcher=new u.b(this._logger),this._leader=new d.b,this._followerRole=new h.a(this._window,this.properties,this._dispatcher,this._logger),this._election=new C(this),this._storage=r}updateConfig(e){b(this.properties,e)}init(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;let n=this,i=n._window;n._mode=!0===n.properties.singletonMode?O.SINGLETON:O.MULTIPLEXING,n._instanceCounters.addInstance(n.properties),function(r){const n=r._metrics;[100,200,500,1e3,2e3,3e3,5e3].forEach(t=>{setTimeout(()=>{var e=((null===(e=r._knownInstances)||void 0===e?void 0:e.size)||0)+1;n.summary("instance.partySize",{after:t,electionState:r._election._state}).record(e)},t)})}(n),n._messenger=new o.a(n.properties.id,i,n._logger),n._messenger.onAnyMessage((e,t)=>{var r=Date.now()-e.timestamp|0;n._metrics.instanceMsgDeliveryTimer({messageType:e.type,sameWindow:i===t}).record(r),n._logger.debug("Message received",e),n._doFireEvent(u.c.ID5_MESSAGE_RECEIVED,e)}).onMessage(o.c.TYPE,(e,t)=>{let r=b(new o.c,e.payload);void 0===r.isResponse&&(r.isResponse=e.dst!==o.b),n._handleHelloMessage(r,e,t)}).onProxyMethodCall(new o.d(this._logger).registerTarget(o.e.LEADER,n._leader).registerTarget(o.e.FOLLOWER,n._followerRole).registerTarget(o.e.STORAGE,n._storage)),n._mode===O.SINGLETON?(n._election.skip(),n._onLeaderElected(n.properties)):n._mode===O.MULTIPLEXING&&n._election.schedule(e),n._messenger.broadcastMessage(n._createHelloMessage(!1),o.c.TYPE),void 0===i.__id5_instances&&(i.__id5_instances=[]),i.__id5_instances.push(n)}register(e){try{this.updateConfig(e),this.init()}catch(e){this._logger.error("Failed to register integration instance",e)}return this}_handleHelloMessage(e,t,r){this._joinInstance(e,t,r)}deregister(){let e=this._window.__id5_instances;void 0!==e&&e.splice(e.indexOf(this),1),this._messenger&&this._messenger.deregister()}on(e,t){return this._dispatcher.on(e,t),this}_joinInstance(e,t,r){var n=e.isResponse;const i=new s(e.instance,e.instanceState,r);this._knownInstances.get(i.getId())?this._logger.debug("Instance already known",i.getId()):(this._knownInstances.set(i.getId(),i),this._lastJoinedInstance=i,this._instanceCounters.addInstance(i.properties),this._metrics.instanceJoinDelayTimer({election:this._election._state}).record(performance.now()-this._loadTime|0),n?(n=i.getInstanceMultiplexingLeader(),this._mode===O.MULTIPLEXING&&this.role===w.UNKNOWN&&void 0!==n&&(this._logger.info("Joined late, elected leader is",n),this._election.cancel(),this._onLeaderElected(n))):(this._messenger.sendResponseMessage(t,this._createHelloMessage(!0),o.c.TYPE),this._mode===O.MULTIPLEXING&&this.role!==w.UNKNOWN&&this._handleLateJoiner(i)),this._logger.debug("Instance joined",i.getId()),this._doFireEvent(u.c.ID5_INSTANCE_JOINED,i.properties))}_createHelloMessage(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];let r={operatingMode:this._mode,knownInstances:Array.from(this._knownInstances.values()).map(e=>e.properties)};return this._mode===O.MULTIPLEXING&&(r.multiplexing={role:this.role,electionState:null===(e=this._election)||void 0===e?void 0:e._state,leader:this._leader.getProperties()}),new o.c(this.properties,t,r)}_handleLateJoiner(e){this._logger.info("Late joiner detected",e.properties);var t=this._metrics.instanceLateJoinCounter(this.properties.id,{scope:"party"}).inc();this._metrics.instanceLateJoinDelayTimer({election:this._election._state,isFirst:1===t}).record(performance.now()-this._election._closeTime),!e.isMultiplexingPartyAllowed()||this.role!==w.LEADER||!0===(null==(e=this._leader.addFollower(new h.b(e,this._messenger,this._logger)))?void 0:e.lateJoiner)&&this._metrics.instanceLateJoinCounter(this.properties.id,{scope:"leader",unique:!0===(null==e?void 0:e.uniqueLateJoiner)}).inc()}_doFireEvent(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._dispatcher.emit(e,...r)}_actAsLeader(){var e=this.properties;const t=this._logger;var r=this._metrics,n=new p.c(this._storage),i=new p.a(n),o=new g.a(e.storageExpirationDays);const s=new f.a(i,o,e.forceAllowLocalStorageGrant,t);o=new v.a(s,new g.b(new m.a(()=>s.localStorageGrant(),i,o,t)),r,t,_.a.createExtensions(r,t));const a=new d.a(this._window,o,e,n,s,r,t);a.addFollower(this._followerRole),this._leader.assignLeader(a),this._mode===O.MULTIPLEXING&&Array.from(this._knownInstances.values()).filter(e=>e.isMultiplexingPartyAllowed()).map(e=>a.addFollower(new h.b(e,this._messenger,t))),a.start()}_followRemoteLeader(e){this._leader.assignLeader(new d.c(this._messenger,e)),this._logger.info("Following remote leader ",e)}updateConsent(e){this._leader.updateConsent(e)}updateFetchIdData(e){b(this.properties.fetchIdData,e),this._leader.updateFetchIdData(this.properties.id,this.properties.fetchIdData)}refreshUid(e){this._leader.refreshUid(e)}_doElection(){var e=this._election;const t=this._knownInstances;let r=Array.from(t.values()).filter(e=>e.isMultiplexingPartyAllowed()).map(e=>e.properties);r.push(this.properties),this._onLeaderElected(function(e){if(!e||0===e.length)return;e=e.sort((e,t)=>{let r=-a.semanticVersionCompare(e.version,t.version);return 0===r&&(r=e.source.localeCompare(t.source),0===r&&(r=-a.semanticVersionCompare(e.sourceVersion,t.sourceVersion)),0===r&&(r=e.id.localeCompare(t.id))),r});return e[0]}(r));var n=this._lastJoinedInstance;n&&this._metrics.instanceLastJoinDelayTimer().record(Math.max(n._joinTime-e._scheduleTime,0))}_onLeaderElected(e){var t=this;t.role=e.id===t.properties.id?w.LEADER:w.FOLLOWER,t.role===w.LEADER?t._actAsLeader():t.role===w.FOLLOWER&&t._followRemoteLeader(e),t._logger.debug("Leader elected",e.id,"my role",t.role),t._doFireEvent(u.c.ID5_LEADER_ELECTED,t.role,t._leader.getProperties())}}},function(e,t){var r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";t.a="1.0.18"},function(e,t,r){"use strict";var a=r(1),n=r(7),i=r(3);function o(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){d(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class u{constructor(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];d(this,"lateJoiner",!1),d(this,"uniqueLateJoiner",!1),this.lateJoiner=e,this.uniqueLateJoiner=t}}class h{updateConsent(e){}updateFetchIdData(e,t){}refreshUid(e){}addFollower(e){}getProperties(){}}t.a=class extends h{constructor(e,t,r,n,i,o){var s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:a.c;super(),d(this,"_followers",void 0),d(this,"_followersRequests",{}),d(this,"_fetcher",void 0),d(this,"_log",void 0),d(this,"_consentManager",void 0),d(this,"_cachedResponse",void 0),d(this,"_inProgressFetch",void 0),d(this,"_queuedRefreshOptions",void 0),d(this,"_lastConsentDataSet",void 0),d(this,"_metrics",void 0),d(this,"_leaderStorage",void 0),this._followers=[],this._fetcher=t,this._properties=r,this._consentManager=i,this._metrics=o,this._window=e,this._leaderStorage=n,this._log=s}_handleRefreshResult(e){const t=e.refreshedResponse;if(void 0!==t){const o=[];var r,n=c(this._followers);try{for(n.s();!(r=n.n()).done;){const s=r.value;var i=t.getResponseFor(s.getId());void 0!==i&&(this._log.debug("Notify uid ready.","Follower:",s.getId(),"Uid:",i),this._notifyUidReady(s,{timestamp:t.timestamp,responseObj:i,isFromCache:!1}),!0===i.cascade_needed&&o.push(s.getId()))}}catch(e){n.e(e)}finally{n.f()}e=e.consentData;void 0!==e&&0<o.length&&this._consentManager.localStorageGrant().isDefinitivelyAllowed()&&this._handleCascade(o,t,e),this._cachedResponse={timestamp:t.timestamp,responseObj:t.getGenericResponse(),isFromCache:!1}}}_handleCachedResponse(e){var t,r={timestamp:e.timestamp,responseObj:e.response,isFromCache:!0},n=c(this._followers);try{for(n.s();!(t=n.n()).done;){const i=t.value;this._log.debug("Notify uid ready.","Follower:",i.getId(),"Uid:",r),this._notifyUidReady(i,r)}}catch(e){n.e(e)}finally{n.f()}this._cachedResponse=r}_notifyUidReady(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r={timestamp:Date.now(),tags:{lateJoiner:r,callType:e.callType}};e.notifyUidReady(t,r)}_handleCascade(e,t,r){var n,i=this._followers.filter(t=>void 0!==e.find(e=>t.getId()===e)&&t.canDoCascade()).sort((e,t)=>{function r(e){var t;return(null===(e=e.getFetchIdData().refererInfo)||void 0===e||null===(t=e.stack)||void 0===t?void 0:t.length)||Number.MAX_SAFE_INTEGER}return r(e)-r(t)});if(0<i.length){const o=i[0];o.notifyCascadeNeeded({partnerId:o.getFetchIdData().partnerId,userId:t.getResponseFor(o.getId()).universal_uid,gdprApplies:r.gdprApplies,consentString:r.consentString,gppString:null===(t=r.gppData)||void 0===t?void 0:t.gppString,gppSid:null===(r=r.gppData)||void 0===r||null===(n=r.applicableSections)||void 0===n?void 0:n.join(",")})}else this._log.error("Couldn't find cascade eligible follower")}_handleCancel(e){var t,r=c(this._followers);try{for(r.s();!(t=r.n()).done;){const n=t.value;n.notifyFetchUidCanceled({reason:e})}}catch(e){r.e(e)}finally{r.f()}}_getId(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this._followers.map(e=>{var t=e.getId(),r=this._followersRequests[t]=(this._followersRequests[t]||0)+1,n=this._properties.id;return s(s({},e.getFetchIdData()),{},{integrationId:t,requestCount:r,role:n===e.getId()?"leader":"follower",cacheId:e.getCacheId()})});this._inProgressFetch=!0;const r=this._fetcher.getId(t,e);r.cachedResponse&&this._handleCachedResponse(r.cachedResponse),r.refreshResult.then(e=>{e.refreshedResponse&&this._handleRefreshResult(e),this._handleFetchCompleted()}).catch(e=>{e instanceof i.h?this._handleCancel(e.message):this._handleFailed(e),this._handleFetchCompleted()})}start(){!0!==this._started&&(this._getId(!1),this._started=!0)}refreshUid(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._inProgressFetch?this._queuedRefreshOptions=e:(!0===e.resetConsent&&this._consentManager.resetConsentData(!0===e.forceAllowLocalStorageGrant),this._getId(!0===e.forceFetch))}updateConsent(e){var t,r,n=this._lastConsentDataSet;n&&(t=(null==e?void 0:e.api)!==n.api,r=(null==e?void 0:e.consentString)!==n.consentString,n=(null==e?void 0:e.ccpaString)!==n.ccpaString,(t||r||n)&&this._metrics.consentChangeCounter({apiChanged:t,consentStringChanged:r,usPrivacyChanged:n}).inc()),this._consentManager.setConsentData(e),this._lastConsentDataSet=e}updateFetchIdData(t,e){const r=this._followers.find(e=>e.getId()===t);r.updateFetchIdData(e)}addFollower(t){const r=t.getId();var e,n=this._cachedResponse;const i=this._log;this._followers.push(t),this._window!==t.getWindow()&&(e=t.getStorage(),i.info("Adding follower's",t.getId(),"storage as replica"),this._leaderStorage.addReplica(e)),i.debug("Added follower",r,"last uid",n);let o=new u;return(n||this._inProgressFetch)&&(o.lateJoiner=!0,n&&this._notifyUidReady(t,s(s({},n),{},{isFromCache:!0}),!0),this._followers.filter(e=>e.getId()!==r).some(e=>t.isSimilarTo(e))||(i.debug("Will refresh uid for new joiner",r),this.refreshUid({forceFetch:!0}),o.uniqueLateJoiner=!0)),o}getProperties(){return this._properties}_handleFetchCompleted(){this._inProgressFetch=void 0,this._queuedRefreshOptions&&(this.refreshUid(this._queuedRefreshOptions),this._queuedRefreshOptions=void 0)}_handleFailed(e){this._log.error("Fetch id failed",e);var t,r=c(this._followers);try{for(r.s();!(t=r.n()).done;){const n=t.value;n.notifyFetchUidCanceled({reason:"error"})}}catch(e){r.e(e)}finally{r.f()}}};t.c=class extends h{constructor(e,t){super(),d(this,"_messenger",void 0),d(this,"_leaderInstanceProperties",void 0),this._messenger=e,this._leaderInstanceProperties=t}_sendToLeader(e,t){this._messenger.callProxyMethod(this._leaderInstanceProperties.id,n.e.LEADER,e,t)}updateConsent(e){this._sendToLeader("updateConsent",[e])}refreshUid(e){this._sendToLeader("refreshUid",[e])}updateFetchIdData(e,t){this._sendToLeader("updateFetchIdData",[e,t])}getProperties(){return this._leaderInstanceProperties}};t.b=class extends h{constructor(){super(...arguments),d(this,"_callsQueue",[]),d(this,"_assignedLeader",void 0)}updateConsent(e){this._callOrBuffer("updateConsent",[e])}updateFetchIdData(e,t){this._callOrBuffer("updateFetchIdData",[e,t])}refreshUid(e){this._callOrBuffer("refreshUid",[e])}addFollower(e){return this._callOrBuffer("addFollower",[e])}getProperties(){if(this._assignedLeader)return this._assignedLeader.getProperties()}assignLeader(e){this._assignedLeader=e;var t,r=c(this._callsQueue);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._callAssignedLeader(n.name,n.args)}}catch(e){r.e(e)}finally{r.f()}this._callsQueue=[]}_callOrBuffer(e,t){if(this._assignedLeader)return this._callAssignedLeader(e,t);this._callsQueue.push({name:e,args:t})}_callAssignedLeader(e,t){return this._assignedLeader[e](...t)}}},function(e,t,r){"use strict";var n=r(8),i=r(7),o=r(1),s=r(4),a=r(0);function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function l(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const d=Object.freeze({DIRECT_METHOD:"direct_method",POST_MESSAGE:"post_message"});class u{constructor(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:o.c;l(this,"_instanceProperties",void 0),l(this,"_log",void 0),l(this,"callType",void 0),l(this,"_instanceWindow",void 0),this._instanceWindow=t,this._instanceProperties=r,this._log=n,this.callType=e}getId(){return this._instanceProperties.id}getFetchIdData(){return this._instanceProperties.fetchIdData}updateFetchIdData(e){c(this._instanceProperties.fetchIdData,e)}getCacheId(){var e=this._instanceProperties.fetchIdData,e={partnerId:e.partnerId,att:e.att,pd:e.pd,provider:e.provider,abTesting:e.abTesting,segments:JSON.stringify(e.segments),providedRefresh:e.providedRefreshInSeconds};return Object(a.cyrb53Hash)(JSON.stringify(e))}isSimilarTo(e){var t=e._instanceProperties.fetchIdData,r=this._instanceProperties.fetchIdData,n=t.partnerId===r.partnerId,i=t.att===r.att,o=t.pd===r.pd,s=t.provider===r.provider,a=JSON.stringify(t.abTesting)===JSON.stringify(r.abTesting),c=JSON.stringify(t.segments)===JSON.stringify(r.segments),r=t.providedRefreshInSeconds===r.providedRefreshInSeconds,a=n&&i&&o&&s&&a&&c&&r;return this._log.debug("Comparing followers this:",this.getId(),"other:",e.getId(),"areSimilar:",a,"reason:",{samePartner:n,sameAtt:i,samePd:o,sameProvider:s,sameSegments:c,sameProvidedRefresh:r}),a}notifyUidReady(e,t){}notifyFetchUidCanceled(e){}notifyCascadeNeeded(e){}canDoCascade(){return!0===this._instanceProperties.canDoCascade}getStorage(){return s.b}getWindow(){return this._instanceWindow}}t.a=class extends u{constructor(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:o.c;super(d.DIRECT_METHOD,e,t,n),l(this,"_dispatcher",void 0),this._dispatcher=r}notifyUidReady(e,t){this._dispatcher.emit(n.a.USER_ID_READY,e,t)}notifyFetchUidCanceled(e){this._dispatcher.emit(n.a.USER_ID_FETCH_CANCELED,e)}notifyCascadeNeeded(e){this._dispatcher.emit(n.a.CASCADE_NEEDED,e)}};class h extends s.d{constructor(e,t){super(),l(this,"_messenger",void 0),l(this,"_destinationId",void 0),this._messanger=e,this._destinationId=t}getItem(e){}removeItem(e){this._remoteCall("removeItem",[e])}setItem(e,t){this._remoteCall("setItem",[e,t])}_remoteCall(e,t){this._messanger.callProxyMethod(this._destinationId,i.e.STORAGE,e,t)}}t.b=class extends u{constructor(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:o.c;super(d.POST_MESSAGE,e.getWindow(),e.properties,r),l(this,"_messenger",void 0),this._messenger=t}_callProxy(e,t){this._messenger.callProxyMethod(this.getId(),i.e.FOLLOWER,e,t)}notifyUidReady(e,t){this._callProxy("notifyUidReady",[e,t])}notifyFetchUidCanceled(e){this._callProxy("notifyFetchUidCanceled",[e])}notifyCascadeNeeded(e){this._callProxy("notifyCascadeNeeded",[e])}getStorage(){return new h(this._messenger,this.getId())}}},function(e,t,r){"use strict";var u=r(0),_=r(3),h=r(10),b=(r(6),r(4));function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){s(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function s(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date.now();s(this,"timestamp",void 0),s(this,"response",void 0),this.response=e,this.timestamp=t}}class l{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date.now();s(this,"timestamp",void 0),s(this,"response",void 0),this.response=e,this.timestamp=t}getGenericResponse(){return this.response.generic}getResponseFor(e){if(this.response.responses[e])return o(o({},this.response.generic),this.response.responses[e])}}class c{constructor(e,t,r){s(this,"_extensionsProvider",void 0),s(this,"_metrics",void 0),s(this,"_log",void 0),this._extensionsProvider=e,this._metrics=t,this._log=r}refreshUid(e,r,n,c,l,d){return this._extensionsProvider.gather(e).then(t=>{const i=e.map(e=>this._createRequest(r,e,c,n,l,t,d)),o=this._log,s=this._metrics,a=this;return new Promise((t,r)=>{const n=Object(h.d)();var e="".concat("https://id5-sync.com").concat("/gm/v3");o.info("Fetching ID5 ID from:",e,i),Object(u.ajax)(e,{success:function(e){n.record(null===s||void 0===s?void 0:s.fetchSuccessfulCallTimer());try{t(a._validateResponse(e))}catch(e){r(e)}},error:function(e){n.record(null===s||void 0===s?void 0:s.fetchFailureCallTimer()),r(e)}},JSON.stringify({requests:i}),{method:"POST",withCredentials:!0},o)})})}_validateResponse(e){if(!e||!Object(u.isStr)(e)||e.length<1)throw new Error('Empty fetch response from ID5 servers: "'.concat(e,'"'));var t=JSON.parse(e);if(!Object(u.isPlainObject)(t.generic))throw new Error("Server response failed to validate: ".concat(e));return this._log.info("Valid json response from ID5 received",t),t}_createRequest(e,r,t,n,i,o,s){var a;this._log.info("Create request data for",{fetchIdData:r,consentData:e,signature:t,nbs:n,refreshInSecondUsed:i,extensions:o});var c=r.partnerId;const l={requestId:r.integrationId,requestCount:r.requestCount,role:r.role,cacheId:r.cacheId,partner:c,v:r.originVersion,o:r.origin,tml:null===(a=r.refererInfo)||void 0===a?void 0:a.topmostLocation,ref:null===(a=r.refererInfo)||void 0===a?void 0:a.ref,cu:null===(a=r.refererInfo)||void 0===a?void 0:a.canonicalUrl,u:(null===(a=r.refererInfo)||void 0===a?void 0:a.stack[0])||window.location.href,top:null!==(a=r.refererInfo)&&void 0!==a&&a.reachedTop?1:0,localStorage:!0===s?1:0,nbPage:n[c],id5cdn:r.isUsingCdn,ua:window.navigator.userAgent,att:r.att};c=e.gdprApplies;Object(u.isDefined)(c)&&(l.gdpr=c?1:0);c=e.consentString;Object(u.isDefined)(c)&&(l.gdpr_consent=c),Object(u.isDefined)(e.allowedVendors)&&(l.allowed_vendors=e.allowedVendors),Object(u.isDefined)(e.gppData)&&(l.gpp_string=e.gppData.gppString,l.gpp_sid=e.gppData.applicableSections.join(",")),Object(u.isDefined)(t)&&(l.s=t);t=r.uaHints;Object(u.isDefined)(t)&&(l.ua_hints=t),Object(u.isDefined)(e.ccpaString)&&""!==e.ccpaString&&(l.us_privacy=e.ccpaString),Object(u.objectEntries)({pd:"pd",partnerUserId:"puid",provider:"provider",segments:"segments"}).forEach(e=>{var t=d(e,2),e=t[0],t=t[1];Object(u.isDefined)(r[e])&&(l[t]=r[e])});e=r.abTesting;e&&!0===e.enabled&&(l.ab_testing={enabled:!0,control_group_pct:e.controlGroupPct});e=r.invalidSegmentsCount;return e&&0<e&&(l._invalid_segments=e),r.trace&&(l._trace=!0),l.provided_options={refresh_in_seconds:r.providedRefreshInSeconds},l.used_refresh_in_seconds=i,l.extensions=o,l}}class y{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;s(this,"consentData",void 0),s(this,"refreshedResponse",void 0),this.consentData=e,this.refreshedResponse=t}}class w{constructor(){s(this,"cachedResponse",void 0),s(this,"refreshResult",void 0)}}t.a=class{constructor(e,t,r,n,i){i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new c(i,r,n);s(this,"_store",void 0),s(this,"_consentManager",void 0),s(this,"_uidRefresher",void 0),s(this,"_metrics",void 0),s(this,"_log",void 0),this._store=t,this._consentManager=e,this._metrics=r,this._log=n,this._uidRefresher=i}getId(d){let u=1<arguments.length&&void 0!==arguments[1]&&arguments[1];const e=new w,h=this._log;h.info("Get id",d);const p=this._store,g=this._consentManager,t=this._metrics,r=g.localStorageGrant();let f,v=!1;r.isDefinitivelyAllowed()&&(h.info("Using local storage for cached ID",r),f=p.getStoredDataState(d)),!f||!f.hasValidUid()||f.pdHasChanged||f.segmentsHaveChanged||f.isStoredIdStale()?h.info("No ID5 User ID available from cache",f):(h.info("ID5 User ID available from cache:",f),e.cachedResponse=new a(f.storedResponse,f.storedDateTime),p.incNbs(d,f),v=!0),h.info("Waiting for consent");const m=t.timer("fetch.consent.wait.time",{cachedResponseUsed:v});return e.refreshResult=g.getConsentData().then(t=>{h.info("Consent received",t),m&&m.recordNow();const e=g.localStorageGrant();if(h.info("Local storage grant",e),!e.allowed)throw h.info("No legal basis to use ID5",t),new _.h(t,"No legal basis to use ID5");var r=b.e.checkIfAccessible();f=p.getStoredDataState(d,t);var n=f.consentHasChanged;e.isDefinitivelyAllowed()&&p.storeRequestData(t,d);var i=!f.isResponseComplete(),o=f.refreshInSecondsHasElapsed(),s=f.pdHasChanged,a=f.segmentsHaveChanged;if(i||o||n||s||a||u||!v){h.info("Decided to fetch a fresh ID5 ID",{missingStoredData:i,refreshInSecondsHasElapsed:o,consentHasChanged:n,pdHasChanged:s,segmentsHaveChanged:a,forceFetch:u,cachedResponseUsed:v});var a=null===(s=f)||void 0===s?void 0:s.nb,s=null===(s=f)||void 0===s||null===(c=s.storedResponse)||void 0===c?void 0:c.signature,c=null===(c=f)||void 0===c?void 0:c.refreshInSeconds;const l=this;return h.info("Fetching ID5 ID (forceFetch:".concat(u,")")),this._uidRefresher.refreshUid(d,t,a,s,c,r).then(e=>l.handleSuccessfulFetchResponse(e,d,v,t))}return new y(t)}),e}handleSuccessfulFetchResponse(e,t,r,n){const i=this._log,o=this._consentManager,s=this._store;var a=new l(e);o.setStoredPrivacy(e.generic.privacy);const c=o.localStorageGrant();return c.isDefinitivelyAllowed()?(i.info("Storing ID and request hashes in cache"),s.storeRequestData(n,t),s.storeResponse(t,a,r)):(i.info("Cannot use local storage to cache ID",c),s.clearAll(t)),new y(n,a)}}},function(e,t,r){"use strict";function o(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function n(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){var t,r;t=n,e=i[r=e],(r=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(r))in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}var i="undefined"!=typeof Promise&&"undefined"!=typeof fetch;t.a=i;t.b=class{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;this.url=e||"https://diagnostics.id5-sync.com/measurements",this._metadata=t}publish(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return e&&0<e.length?(e.forEach(e=>function(r){Object.keys(r).forEach(function(e){var t=r[e];t&&(t instanceof Object?r[e]=JSON.stringify(t):r[e]="".concat(t))})}(e.tags)),fetch(this.url,{method:"POST",headers:{"Content-Type":"text/plain"},mode:"no-cors",body:JSON.stringify({metadata:n(n({},this._metadata),t),measurements:e})})):Promise.resolve()}}},function(e,t,r){"use strict";var n=r(13),i=r(14);function o(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){a(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function a(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class d{has(e){return void 0!==this[e]}set(e,t){return this[e]=t,this}get(e){return this[e]}values(){return Object.entries(this).map(e=>{e=c(e,2),e[0];return e[1]})}}t.a=class{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;a(this,"_registry",void 0),a(this,"commonTags",void 0),a(this,"_scheduled",void 0),this._registry=new d,this.commonTags=i.a.from(e),this.commonPrefix=t}getOrCreate(e,t,r){var n=s(s({},t),this.commonTags),t=this.commonPrefix?this.commonPrefix+"."+e:e,e="".concat(t,"[").concat(i.a.toString(n),"]");return this._registry.has(e)||this._registry.set(e,r(t,n)),this._registry.get(e)}getAllMeasurements(){return this._registry.values().map(e=>({name:e.name,type:e.type,tags:e.tags,values:e.values})).filter(function(e){return e.values&&0<e.values.length})}reset(){Array.from(this._registry.values()).forEach(e=>e.reset())}addCommonTags(e){this.commonTags=s(s({},this.commonTags),i.a.from(e))}timer(e){return this.getOrCreate(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},(e,t)=>new n.d(e,t))}counter(e){return this.getOrCreate(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},(e,t)=>new n.a(e,t))}summary(e){return this.getOrCreate(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},(e,t)=>new n.b(e,t))}publish(){let t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:e=>e,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return Promise.resolve(this.getAllMeasurements()).then(e=>t(e,r)).then(e=>this.reset())}schedulePublishAfterMsec(t,r){if(!this._scheduled){let e=this;setTimeout(()=>(e._scheduled=!1,e.publish(r,{trigger:"fixed-time",fixed_time_msec:t})),t),this._scheduled=!0}return this}schedulePublishBeforeUnload(e){let t=this;return addEventListener("beforeunload",()=>t.publish(e,{trigger:"beforeunload"})),this}}},function(e,t,r){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var s,n=(s=window,function(){try{var r=a(),n=r.length-1,i=null!==r[n].location||0<n&&null!==r[n-1].referrer,o=function(e){let t=[];var r,n=null;let i=null,o=null,s=null,a=null,c;for(c=e.length-1;0<=c;c--){try{i=e[c].location}catch(e){}if(i)t.push(i),a=a||i;else if(0!==c){r=e[c-1];try{o=r.referrer,s=r.ancestor}catch(e){}o?(t.push(o),a=a||o):s?(t.push(s),a=a||s):t.push(n)}else t.push(n)}return{stack:t,detectedRefererUrl:a}}(r);let e,t;r[r.length-1].canonicalUrl&&(e=r[r.length-1].canonicalUrl);try{t=s.top.document.referrer}catch(e){}return{topmostLocation:o.detectedRefererUrl,ref:t||null,reachedTop:i,numIframes:n,stack:o.stack,canonicalUrl:e}}catch(e){}});function a(){let r=function(){let t=[],r;do{try{r=r?r.parent:s;try{var n=r===s.top;let e={referrer:r.document.referrer||null,location:r.location.href||null,isTop:n};n&&(e=i(e,{canonicalUrl:function(e){try{var t=e.querySelector("link[rel='canonical']");if(null!==t)return t.href}catch(e){}return null}(r.document)})),t.push(e)}catch(e){t.push({referrer:null,location:null,isTop:r===s.top})}}catch(e){return t.push({referrer:null,location:null,isTop:!1}),t}}while(r!==s.top);return t}();var n=function(){try{return s.location.ancestorOrigins?s.location.ancestorOrigins:void 0}catch(e){}}();if(n)for(let e=0,t=n.length;e<t;e++)r[e].ancestor=n[e];return r}t.a=n},function(e,t,r){"use strict";var d=r(5),n=r(29),s=r(2);function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function u(a){return function(){var e=this,s=arguments;return new Promise(function(t,r){var n=a.apply(e,s);function i(e){l(n,t,r,i,o,"next",e)}function o(e){l(n,t,r,i,o,"throw",e)}i(void 0)})}}function a(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const h=Object.freeze({tcfv1:{objName:"__cmpCall",objKeys:["command","parameter"],returnObjName:"__cmpReturn"},tcfv2:{objName:"__tcfapiCall",objKeys:["command","version"],returnObjName:"__tcfapiReturn"},uspv1:{objName:"__uspapiCall",objKeys:["command","version"],returnObjName:"__uspapiReturn"},gppv1:{objName:"__gppCall",objKeys:["command","parameter"],returnObjName:"__gppReturn"}}),p=Object.freeze({TCF:0,USP:1,GPP:2});class g{constructor(e,t){a(this,"direct",void 0),a(this,"version",void 0),this.direct=e,this.version=t}getConsentData(){var e=this;return u(function*(){return e.getClientConsentData()})()}static create(a){return u(function*(){var e=m._findCmpApi("__gpp"),t=e.cmpApiFrame,e=e.cmpApiFunction;let r,n=!1;if(!t)return a.warn("cmpApi: GPP not found! Using defaults."),Promise.resolve();if(Object(d.j)(e))n=!0,a.info("cmpApi: Detected GPP is directly accessible, calling it now."),r=e;else{a.info("cmpApi: Detected GPP is outside the current iframe. Using message passing.");const s=m._buildCmpSurrogate("gppv1",t);r=function(e,t,r){s(e,r,t)}}var i=yield new Promise(t=>{var e=r("ping",function(e){t(e)});e&&t(e)});switch(i.gppVersion){case f.version:return new f(i,r,n);case v.version:return new v(i,r,n);default:var o="Unsupported version of gpp: ".concat(i.gppVersion);return a.warn(o),Promise.reject(o)}})()}static tcfDataHasLocalStorageGrant(e){return Object(d.h)(e.PurposeConsent)&&!0===e.PurposeConsent[0]&&0<=(null===(e=e.VendorConsent)||void 0===e?void 0:e.indexOf(s.h))}}class f extends g{constructor(e,t,r){super(r,f.version),a(this,"gppFn",void 0),a(this,"ready",void 0),this.gppFn=t,this.ready=this.isReady(e)}isReady(e){return"loaded"===e.cmpStatus&&"visible"!==e.cmpDisplayStatus}getClientConsentData(){var n=this;return u(function*(){n.ready||(n.ready=yield new Promise(t=>{n.gppFn("addEventListener",e=>!!n.isReady(e.pingData)&&void t(!0))}));var e=new Promise(t=>{n.gppFn("getGPPData",e=>{t(e)})}),t=new Promise(t=>{n.gppFn("getSection",e=>{t(e)},"tcfeuv2")}),e=i(yield Promise.all([e,t]),2),t=e[0],e=e[1];const r=new s.g;return r.version=s.a.GPP_V1_0,r.gppString=t.gppString,r.applicableSections=t.applicableSections,e&&(r.localStoragePurposeConsent=g.tcfDataHasLocalStorageGrant(e)),r})()}}a(f,"version","1.0");class v extends g{constructor(e,t,r){super(r,v.version),a(this,"gppFn",void 0),a(this,"readyPingData",void 0),this.gppFn=t,"ready"===e.signalStatus&&(this.readyPingData=e)}getClientConsentData(){var r=this;return u(function*(){return new Promise(t=>{r.readyPingData?t(r.parsePingData(r.readyPingData)):r.gppFn("addEventListener",e=>"ready"===e.pingData.signalStatus&&void t(r.parsePingData(e.pingData)))})})()}parsePingData(e){const t=new s.g;t.gppString=e.gppString,t.version=s.a.GPP_V1_1,t.applicableSections=e.applicableSections;e=null===(e=e.parsedSections)||void 0===e?void 0:e.tcfeuv2;return e&&(t.localStoragePurposeConsent=g.tcfDataHasLocalStorageGrant(e[0])),t}}a(v,"version","1.1");class m{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s.k;a(this,"_lookupInProgress",void 0),a(this,"_log",void 0),a(this,"_metrics",void 0),a(this,"_consentDataPromise",void 0),this._metrics=e,this._log=t}refreshConsentData(e,t,r){const n=this;return n._lookupInProgress||(n._lookupInProgress=!0,n._consentDataPromise=this._lookupConsentData(e,t,r).finally(()=>{n._lookupInProgress=!1})),this._consentDataPromise}_lookupConsentData(e,t,r){if(e){this._log.warn("cmpApi: ID5 is operating in forced consent mode and will not retrieve any consent signals from the CMP");let e=new s.e;return e.forcedGrantByConfig=!0,Promise.resolve(e)}switch(t){case"static":return new Promise((e,t)=>{this._parseStaticConsentData(r,e)});case"iab":return new Promise((e,t)=>{this._lookupIabConsent(e)});default:return this._log.error("cmpApi: Unknown consent API: ".concat(t)),Promise.reject(new Error("Unknown consent API: ".concat(t)))}}_parseStaticConsentData(e,t){e=e||{};var r=new s.e;let n={};Object(d.n)(e.getConsentData)?n=this._parseTcfData(e,1):Object(d.n)(e.getTCData)?n=this._parseTcfData(e.getTCData,2):Object(d.h)(e.allowedVendors)?n={api:s.a.ID5_ALLOWED_VENDORS,allowedVendors:e.allowedVendors.map(e=>e.toString()),gdprApplies:!0}:Object(d.n)(e.getUSPData)?n=this._parseUspData(e.getUSPData):this._log.warn("cmpApi: No static consent data detected! Using defaults."),c(r,n),this._log.info("cmpApi: Detected API '".concat(r.api,"' from static consent data"),e),t(r)}_lookupIabConsent(r){const n=[];let i=new s.e;var e=t=>(n[t]=0,e=>{n[t]||(n[t]=Date.now(),e&&c(i,e),n.every(e=>0<e)&&r(i))}),t=e(p.TCF),o=e(p.USP),e=e(p.GPP);this._lookupGpp(e),this._lookupTcf(t),this._lookupUsp(o)}_lookupUsp(r){var e=m._findCmpApi("__uspapi"),t=e.cmpApiFrame,e=e.cmpApiFunction;let n;if(!t)return this._log.warn("cmpApi: USP not found! Using defaults for CCPA."),void r();n=Object(d.j)(e)?(this._log.info("cmpApi: Detected USP is directly accessible, calling it now."),e):(this._log.info("cmpApi: Detected USP is outside the current iframe. Using message passing."),m._buildCmpSurrogate("uspv1",t));n("getUSPData",1,(e,t)=>{t?r(this._parseUspData(e)):(this._log.error("cmpApi: USP callback not successful. Using defaults for CCPA."),r())})}_lookupGpp(s){var a=this;return u(function*(){var t=Date.now();try{let e=yield g.create(a._log);if(e){var r={gppVersion:e.version,directCmp:e.direct};try{var n=yield e.getConsentData(),i={api:n.version,gppData:n};s(i);var o=Date.now();a._metrics.timer("gpp.delay",r).record(o-t)}catch(e){a._metrics.counter("gpp.failure",c({type:"CONSENT"},r)).inc(),a._log.error("cmpApi: getting GPP consent not successful. Using defaults for Gpp."),s()}}else s()}catch(e){a._metrics.counter("gpp.failure",{type:"CLIENT"}).inc(),a._log.error("cmpApi: creating GPP client not successful. Using defaults for Gpp."),s()}})()}static _buildCmpSurrogate(c,l){return(e,t,r)=>{const n=Math.random()+"",i=h[c],o={},s={};s[i.objKeys[0]]=e,s[i.objKeys[1]]=t,s.callId=n,o[i.objName]=s;const a=e=>{e=Object(d.e)(e,"data.".concat(i.returnObjName));e&&e.callId===n&&(void 0!==(e=r(e.returnValue,e.success))&&!0!==e||window.removeEventListener("message",a))};window.addEventListener("message",a,!1),l.postMessage(o,"*")}}_lookupTcf(e){var t=m._findTCF(),r=t.cmpVersion,n=t.cmpFrame,t=t.cmpFunction;if(!n)return this._log.warn("cmpApi: TCF not found! Using defaults for GDPR."),void e();Object(d.j)(t)?this._lookupDirectTcf(r,t,e):(this._log.info("cmpApi: Detected TCF is outside the current iframe. Using message passing."),this._lookupMessageTcf(r,n,e))}_lookupMessageTcf(e,t,r){t=m._buildCmpSurrogate(1===e?"tcfv1":"tcfv2",t);this._lookupDirectTcf(e,t,r)}_lookupDirectTcf(e,t,n){const i=this._log,o={},s={},a=(e,t,r)=>{i.info("cmpApi: TCFv".concat(e," - Received a call back: ").concat(t),r)},c=(e,t)=>{i.error("cmpApi: TCFv".concat(e," - Received insuccess: ").concat(t,". Please check your CMP setup. Using defaults for GDPR."))};var r,l=r=>(s[r]=!1,(e,t)=>{s[r]=!0,t?(a(1,r,e),o[r]=e):c(1,r),Object.values(s).every(e=>e)&&n(this._parseTcfData(o,1))}),d=(e,t)=>(a(2,"event",e),t?!(!e||!1!==e.gdprApplies&&"tcloaded"!==e.eventStatus&&"useractioncomplete"!==e.eventStatus)&&void n(this._parseTcfData(e,2)):(c(2,"addEventListener"),void n()));1===e?(r=l("getConsentData"),l=l("getVendorConsents"),t("getConsentData",null,r),t("getVendorConsents",null,l)):2===e&&t("addEventListener",e,d)}_parseUspData(e){if(Object(d.n)(e)&&Object(d.o)(e.uspString))return{api:s.a.USP_V1,ccpaString:e.uspString};this._log.error("cmpApi: No or malformed USP data. Using defaults for CCPA.")}_parseTcfData(e,t){let r=this._log,n,i;if(1===t)n=m._isValidV1ConsentObject,i=m._normalizeV1Data;else{if(2!==t)return void r.error("cmpApi: No or malformed CMP data. Using defaults for GDPR.");n=m._isValidV2ConsentObject,i=m._normalizeV2Data}if(n(e))return i(e);r.error("cmpApi: Invalid CMP data. Using defaults for GDPR.",e)}static _isValidV1ConsentObject(e){var t=Object(d.e)(e,"getConsentData.gdprApplies");return!!Object(d.i)(t)&&(!1===t||Object(d.o)(e.getConsentData.consentData)&&Object(d.n)(e.getVendorConsents)&&1<Object.keys(e.getVendorConsents).length)}static _isValidV2ConsentObject(e){var t=e&&e.gdprApplies,e=e&&e.tcString;return!1===t||Object(d.o)(e)}static _normalizeV1Data(e){return{consentString:e.getConsentData.consentData,localStoragePurposeConsent:Object(d.e)(e,"getVendorConsents.purposeConsents.1"),gdprApplies:e.getConsentData.gdprApplies,api:s.a.TCF_V1}}static _normalizeV2Data(e){let t=Object(d.e)(e,"purpose.consents.1");return Object(d.i)(t)||(t=Object(n.a)(e.tcString,1)),{consentString:e.tcString,localStoragePurposeConsent:t,gdprApplies:e.gdprApplies,api:s.a.TCF_V2}}static _findTCF(){let e=0,t=window,r,n;for(;!r;){try{if("function"==typeof t.__tcfapi||"function"==typeof t.__cmp){n="function"==typeof t.__tcfapi?(e=2,t.__tcfapi):(e=1,t.__cmp),r=t;break}}catch(e){}try{if(t.frames.__tcfapiLocator){e=2,r=t;break}}catch(e){}try{if(t.frames.__cmpLocator){e=1,r=t;break}}catch(e){}if(t===window.top)break;t=t.parent}return{cmpVersion:e,cmpFrame:r,cmpFunction:n}}static _findCmpApi(e){let t=window,r,n;for(;!r;){try{if("function"==typeof t[e]){n=t[e],r=t;break}}catch(e){}try{if(t.frames["".concat(e,"Locator")]){r=t;break}}catch(e){}if(t===window.top)break;t=t.parent}return{cmpApiFrame:r,cmpApiFunction:n}}}t.a=m},function(e,t,r){"use strict";t.a=function(e,t){var r=152+t-1,t=~~(r/i);if(!e||"C"!==e.charAt(0)||e.length<=t)return;t=e.charAt(t),t=n[t];if(void 0===t)return;r%=i,r=1<<i-r-1,r&=t;return 0!=r};const n={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"-":62,_:63,"+":62,"/":63},i=6},function(e,t,r){"use strict";var o=r(5),n=r(2);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function a(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class s{constructor(e,t,r,n,i,o,s){a(this,"_availableCallbackTimerId",void 0),a(this,"_availableCallbackFired",!1),a(this,"_availableCallback",void 0),a(this,"_updateCallback",void 0),a(this,"_refreshCallbackTimerId",void 0),a(this,"_refreshCallbackFired",!1),a(this,"_refreshCallback",void 0),a(this,"_isExposed",void 0),a(this,"_fromCache",void 0),a(this,"_isRefreshing",!1),a(this,"_isRefreshingWithFetch",!1),a(this,"_userId",void 0),a(this,"_ext",void 0),a(this,"_userIdAvailable",!1),a(this,"_userIdAvailablePromise",void 0),a(this,"_userIdAvailablePromiseResolver",void 0),a(this,"invocationId",void 0),a(this,"config",void 0),a(this,"clientStore",void 0),a(this,"consentManagement",void 0),a(this,"_consentDataProvider",void 0),a(this,"_metrics",void 0),a(this,"_logger",void 0),this.config=e,this.clientStore=t,this.consentManagement=r,this._metrics=n,this._consentDataProvider=i,this._logger=o,this.instance=s,this._userIdAvailablePromise=new Promise(e=>{this._userIdAvailablePromiseResolver=e})}getOptions(){return this.config.getOptions()}getProvidedOptions(){return this.config.getProvidedOptions()}getInvalidSegments(){return this.config.getInvalidSegments()}updateOptions(e){return this.config.updOptions(e)}startRefresh(e){this._isRefreshing=!0,this._isRefreshingWithFetch=e}setUserId(e,t){const r=this;var n=e.universal_uid;if(this._isExposed=!0,Object(o.n)(e.ab_testing))switch(e.ab_testing.result){case"normal":break;default:case"error":this._logger.error("Id5Status: There was an error with A/B Testing. Make sure controlGroupRatio is a number >= 0 and <= 1");break;case"control":this._isExposed=!1,this.info("User is in control group!")}var i=this._userId!==n||!1===Object(o.c)(this._ext,e.ext);this._userIdAvailable=!0,this._userId=n,this._userIdAvailablePromiseResolver(n),this._ext=e.ext,this._fromCache=t,this.info("User id updated, hasChanged: ".concat(i,", fromCache: ").concat(t)),Object(o.j)(this._availableCallback)&&!1===this._availableCallbackFired&&(this._availableCallbackTimerId&&(this.info("Cancelling pending onAvailableCallback watchdog"),clearTimeout(this._availableCallbackTimerId),this._availableCallbackTimerId=void 0),this._availableCallbackTimerId=setTimeout(()=>s.doFireOnAvailableCallBack(r),0)),this._isRefreshing&&Object(o.j)(this._refreshCallback)&&!1===this._refreshCallbackFired&&(!1!==t&&!1!==this._isRefreshingWithFetch||(this._refreshCallbackTimerId&&(this.info("Cancelling pending onRefreshCallback watchdog"),clearTimeout(this._refreshCallbackTimerId),this._refreshCallbackTimerId=void 0),this._refreshCallbackTimerId=setTimeout(()=>s.doFireOnRefreshCallBack(r),0))),i&&Object(o.j)(this._updateCallback)&&setTimeout(()=>s.doFireOnUpdateCallBack(r),0)}getUserId(){return!1===this._isExposed?"0":this._userId}getLinkType(){return!1===this._isExposed?0:this.getExt().linkType}getExt(){var e=!1===this._isExposed?{}:this._ext;return i({abTestingControlGroup:!this.exposeUserId()},e)}isFromCache(){return this._fromCache}exposeUserId(){return this._isExposed}getUserIdAsEid(){return{source:n.c.ID5_EIDS_SOURCE,uids:[{atype:1,id:this.getUserId(),ext:this.getExt()}]}}onAvailable(e,t){if(!Object(o.j)(e))throw new Error("onAvailable expect a function");if(Object(o.j)(this._availableCallback))this.info("onAvailable was already called, ignoring");else{this._availableCallback=e;const r=this;this._userIdAvailable?(this.info("User id already available firing callback immediately"),this._availableCallbackTimerId=setTimeout(()=>s.doFireOnAvailableCallBack(r),0)):0<t&&(this._availableCallbackTimerId=setTimeout(()=>s.doFireOnAvailableCallBack(r),t))}return this}onUpdate(e){if(!Object(o.j)(e))throw new Error("onUpdate expect a function");this._updateCallback=e;const t=this;return this._userIdAvailable&&setTimeout(()=>s.doFireOnUpdateCallBack(t),0),this}onRefresh(e,t){if(!Object(o.j)(e))throw new Error("onRefresh expect a function");this._refreshCallbackTimerId&&(clearTimeout(this._refreshCallbackTimerId),this._refreshCallbackTimerId=void 0),this._refreshCallback=e;const r=this;return!0===this._isRefreshing&&!1===this._isRefreshingWithFetch&&this._userIdAvailable?this._refreshCallbackTimerId=setTimeout(()=>s.doFireOnRefreshCallBack(r),0):0<t&&(this._refreshCallbackTimerId=setTimeout(()=>s.doFireOnRefreshCallBack(r),t)),this}localStorageGrant(){return this.clientStore.localStorageGrant()}info(e){this._logger.info("Id5Status: "+e)}collectEvent(t,r){const n=e=>{e=new Request("https://id5-sync.com/event",{method:"POST",mode:"no-cors",body:JSON.stringify({partnerId:this.config.getOptions().partnerId,id5id:e,eventType:t,metadata:r})});return this.info("Sending event",e),fetch(e).catch(e=>this._logger.error("Error while sending event to ID5 of type "+t,e))};return this._userIdAvailable?n(this._userId):this._userIdAvailablePromise.then(e=>n(e))}static doFireOnAvailableCallBack(e){e.info("Id5Status.doFireOnAvailableCallBack"),e._availableCallbackFired=!0,e._availableCallbackTimerId=void 0,e._availableCallback(e)}static doFireOnUpdateCallBack(e){e.info("Id5Status.doFireOnUpdateCallBack"),e._updateCallback(e)}static doFireOnRefreshCallBack(e){e.info("Id5Status.doFireOnRefreshCallBack"),e._refreshCallbackFired=!0,e._refreshCallbackTimerId=void 0,e._isRefreshing=!1,e._isRefreshingWithFetch=!1,e._refreshCallback(e)}}t.a=s},function(e,t,r){"use strict";t.a="1.0.56"},function(e,t,r){"use strict";var u=r(0),h=r(5),n=r(2);function p(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function g(e,t,r){return(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);t=r.call(e,t||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class f{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:n.k;if(g(this,"invocationId",void 0),g(this,"options",void 0),g(this,"providedOptions",void 0),g(this,"invalidSegments",void 0),this._log=t,this.options={debugBypassConsent:!1,allowLocalStorageWithoutConsentApi:!1,cmpApi:"iab",consentData:{getConsentData:{consentData:void 0,gdprApplies:void 0},getVendorConsents:{}},refreshInSeconds:7200,partnerId:void 0,partnerUserId:void 0,callbackOnAvailable:void 0,callbackOnUpdates:void 0,callbackTimeoutInMs:void 0,pd:void 0,abTesting:{enabled:!1,controlGroupPct:0},provider:void 0,maxCascades:8,applyCreativeRestrictions:!1,acr:!1,segments:void 0,disableUaHints:!1,storageExpirationDays:void 0,att:void 0,diagnostics:{publishingDisabled:!1,publishAfterLoadInMsec:3e4,publishBeforeWindowUnload:!0,publishingSampleRatio:.01},multiplexing:{_disabled:!1}},this.providedOptions={},!Object(h.m)(e.partnerId)&&!Object(h.o)(e.partnerId))throw new Error("partnerId is required and must be a number or a string");this.invalidSegments=0,this.updOptions(e),this.storageConfig=new n.l(e.storageExpirationDays)}getOptions(){return this.options}getProvidedOptions(){return this.providedOptions}getInvalidSegments(){return this.invalidSegments}hasCreativeRestrictions(){return this.options.applyCreativeRestrictions||this.options.acr}updOptions(a){const c=this,l=c._log;if(Object(h.n)(a)){this.setPartnerId(a.partnerId);const d=(e,t)=>{this.options[e]=t,this.providedOptions[e]=t};Object.keys(a).forEach(e=>{if("segments"===e){const n=a[e],i=[];Object(u.isDefined)(n)&&(Object(h.h)(n)?(n.forEach((e,t)=>{t="segments[".concat(t,"]");return Object(h.h)(e.ids)&&Object(h.b)(e.ids,h.o)?e.ids.length<1?(l.error("Config option ".concat(t,".ids should contain at least one segment ID")),void(c.invalidSegments+=1)):Object(h.o)(e.destination)?void i.push(e):(v(l,"".concat(t,".destination"),"String",e.destination),void(c.invalidSegments+=1)):(v(l,"".concat(t,".ids"),"Array of String",e.ids),void(c.invalidSegments+=1))}),d(e,i)):v(l,e,"Array",n))}else if("diagnostics"===e){const o=this.options.diagnostics,s=a.diagnostics;if(Object(h.g)(s,f.configTypes.diagnostics)){let t=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?p(Object(r),!0).forEach(function(e){g(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},o);Object.keys(s).forEach(e=>{void 0!==o[e]&&typeof o[e]==typeof s[e]&&(t[e]=s[e])}),this.options[e]=t}this.providedOptions[e]=a[e]}else{var t,r;"partnerId"!==e&&(t=f.configTypes[e],r=a[e],Object(u.isDefined)(r)&&(Object(h.g)(r,t)?d(e,r):v(l,e,t,r)))}})}else l.error("Config options must be an object")}setPartnerId(e){let t;if(Object(h.o)(e)){if(t=parseInt(e),isNaN(t)||t<0)throw new Error("partnerId is required and must parse to a positive integer")}else Object(h.m)(e)&&(t=e);if(Object(h.m)(t)){if(Object(h.m)(this.options.partnerId)&&t!==this.options.partnerId)throw new Error("Cannot update config with a different partnerId");this.options.partnerId=t,this.providedOptions.partnerId=e}}}function v(e,t,r,n){e.error("Config option ".concat(t," must be of type ").concat(r," but was ").concat(toString.call(n),". Ignoring..."))}g(t.a=f,"configTypes",{debugBypassConsent:"Boolean",allowLocalStorageWithoutConsentApi:"Boolean",cmpApi:"String",consentData:"Object",refreshInSeconds:"Number",partnerUserId:"String",callbackOnAvailable:"Function",callbackOnUpdates:"Function",callbackTimeoutInMs:"Number",pd:"String",abTesting:"Object",provider:"String",maxCascades:"Number",applyCreativeRestrictions:"Boolean",acr:"Boolean",disableUaHints:"Boolean",storageExpirationDays:"Number",att:"Number",diagnostics:"Object",multiplexing:"Object",dynamicConfig:"Object"})}]);